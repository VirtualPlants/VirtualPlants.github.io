<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>openalea.grapheditor.baselisteners &mdash; OpenAlea community website</title>
    
    <link rel="stylesheet" href="../../../_static/virtualplants.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="OpenAlea community website" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">OpenAlea community website</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for openalea.grapheditor.baselisteners</h1><div class="highlight"><pre>
<span class="c"># -*- python -*-</span>
<span class="c">#</span>
<span class="c">#       OpenAlea.Visualea: OpenAlea graphical user interface</span>
<span class="c">#</span>
<span class="c">#       Copyright 2006-2009 INRIA - CIRAD - INRA</span>
<span class="c">#</span>
<span class="c">#       File author(s): Daniel Barbeau &lt;daniel.barbeau@sophia.inria.fr&gt;</span>
<span class="c">#</span>
<span class="c">#       Distributed under the Cecill-C License.</span>
<span class="c">#       See accompanying file LICENSE.txt or copy at</span>
<span class="c">#           http://www.cecill.info/licences/Licence_CeCILL-C_V1-en.html</span>
<span class="c">#</span>
<span class="c">#       OpenAlea WebSite : http://openalea.gforge.inria.fr</span>
<span class="c">#</span>
<span class="c">###############################################################################</span>
<span class="sd">&quot;&quot;&quot;Generic Graph Widget&quot;&quot;&quot;</span>

<span class="n">__license__</span> <span class="o">=</span> <span class="s">&quot;Cecill-C&quot;</span>
<span class="n">__revision__</span> <span class="o">=</span> <span class="s">&quot; $Id$ &quot;</span>


<span class="kn">import</span> <span class="nn">types</span>
<span class="kn">import</span> <span class="nn">weakref</span>
<span class="kn">import</span> <span class="nn">observer</span>
<span class="kn">import</span> <span class="nn">interfaces</span>



<div class="viewcode-block" id="StrategyError"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.StrategyError">[docs]</a><span class="k">class</span> <span class="nc">StrategyError</span><span class="p">(</span> <span class="ne">Exception</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="ne">Exception</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_msg</span> <span class="o">=</span> <span class="n">msg</span>
        <span class="k">return</span>

<div class="viewcode-block" id="StrategyError.get_message"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.StrategyError.get_message">[docs]</a>    <span class="k">def</span> <span class="nf">get_message</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msg</span>

</div></div>
<div class="viewcode-block" id="GraphElementListenerBase"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.GraphElementListenerBase">[docs]</a><span class="k">class</span> <span class="nc">GraphElementListenerBase</span><span class="p">(</span><span class="n">observer</span><span class="o">.</span><span class="n">AbstractListener</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for elements in a GraphView&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">observer</span><span class="o">.</span><span class="n">AbstractListener</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__obsBBox</span> <span class="o">=</span> <span class="n">BlackBoxModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">observed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_graph</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
        <span class="k">return</span>

<div class="viewcode-block" id="GraphElementListenerBase.set_observed"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.GraphElementListenerBase.set_observed">[docs]</a>    <span class="k">def</span> <span class="nf">set_observed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">observed</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_observed</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Clear observer before setting a new one&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__obsBBox</span><span class="p">(</span><span class="n">observed</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GraphElementListenerBase.get_observed"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.GraphElementListenerBase.get_observed">[docs]</a>    <span class="k">def</span> <span class="nf">get_observed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__obsBBox</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="GraphElementListenerBase.store_view_data"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.GraphElementListenerBase.store_view_data">[docs]</a>    <span class="k">def</span> <span class="nf">store_view_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="GraphElementListenerBase.get_view_data"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.GraphElementListenerBase.get_view_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_view_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="GraphElementListenerBase.initialise_from_model"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.GraphElementListenerBase.initialise_from_model">[docs]</a>    <span class="k">def</span> <span class="nf">initialise_from_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_view_data</span><span class="p">(</span><span class="s">&quot;position&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_position</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">pos</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">position_changed</span><span class="p">(</span><span class="o">*</span><span class="n">pos</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GraphElementListenerBase.clear_observed"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.GraphElementListenerBase.clear_observed">[docs]</a>    <span class="k">def</span> <span class="nf">clear_observed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__obsBBox</span><span class="o">.</span><span class="n">clear_observed</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="GraphElementListenerBase.change_observed"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.GraphElementListenerBase.change_observed">[docs]</a>    <span class="k">def</span> <span class="nf">change_observed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_observed</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_observed</span><span class="p">(</span><span class="n">new</span><span class="p">)</span>
        <span class="c">#currently, the grapheditor widget maps models with graphical items</span>
        <span class="c">#to track which graphic item to delete when something is being</span>
        <span class="c">#deleted in the model:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_view</span><span class="p">()</span><span class="o">.</span><span class="n">_unregister_widget_from_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_view</span><span class="p">()</span><span class="o">.</span><span class="n">_register_widget_with_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GraphElementListenerBase.set_graph"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.GraphElementListenerBase.set_graph">[docs]</a>    <span class="k">def</span> <span class="nf">set_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="p">):</span>
        <span class="k">if</span><span class="p">(</span><span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__graph</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GraphElementListenerBase.graph"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.GraphElementListenerBase.graph">[docs]</a>    <span class="k">def</span> <span class="nf">graph</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__graph</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="GraphElementListenerBase.notify"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.GraphElementListenerBase.notify">[docs]</a>    <span class="k">def</span> <span class="nf">notify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sender</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;called by the observed when something happens</span>
<span class="sd">        to it.&quot;&quot;&quot;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;metadata_changed&quot;</span><span class="p">):</span>
            <span class="k">if</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s">&quot;position&quot;</span><span class="p">):</span>
                <span class="k">if</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">position_changed</span><span class="p">(</span><span class="o">*</span><span class="n">event</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="GraphElementListenerBase.get_view"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.GraphElementListenerBase.get_view">[docs]</a>    <span class="k">def</span> <span class="nf">get_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="GraphElementListenerBase.add_to_view"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.GraphElementListenerBase.add_to_view">[docs]</a>    <span class="k">def</span> <span class="nf">add_to_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;An element adds itself to the given view&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</div>
<div class="viewcode-block" id="GraphElementListenerBase.remove_from_view"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.GraphElementListenerBase.remove_from_view">[docs]</a>    <span class="k">def</span> <span class="nf">remove_from_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;An element removes itself from the given view&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</div>
<div class="viewcode-block" id="GraphElementListenerBase.position_changed"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.GraphElementListenerBase.position_changed">[docs]</a>    <span class="k">def</span> <span class="nf">position_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Updates the item&#39;s **graphical** position from</span>
<span class="sd">        model notifications. &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</div>
<div class="viewcode-block" id="GraphElementListenerBase.lock_position"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.GraphElementListenerBase.lock_position">[docs]</a>    <span class="k">def</span> <span class="nf">lock_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</div>
<div class="viewcode-block" id="GraphElementListenerBase.default_position"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.GraphElementListenerBase.default_position">[docs]</a>    <span class="k">def</span> <span class="nf">default_position</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</div></div>
<div class="viewcode-block" id="GraphViewBase"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.GraphViewBase">[docs]</a><span class="k">class</span> <span class="nc">GraphViewBase</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<div class="viewcode-block" id="GraphViewBase.set_canvas"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.GraphViewBase.set_canvas">[docs]</a>    <span class="k">def</span> <span class="nf">set_canvas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">canvas</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

</div></div>
<div class="viewcode-block" id="GraphListenerBase"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.GraphListenerBase">[docs]</a><span class="k">class</span> <span class="nc">GraphListenerBase</span><span class="p">(</span><span class="n">observer</span><span class="o">.</span><span class="n">AbstractListener</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This object strictly watches the given graph.</span>
<span class="sd">    It deduces the correct representation out</span>
<span class="sd">    of a known list of representations.</span>

<span class="sd">    It is MVC oriented.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_make_scene</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">stratCls</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">observableGraph</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">clone</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">scene</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">make_scene</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">clone</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">scene</span><span class="o">.</span><span class="n">set_strategy</span><span class="p">(</span><span class="n">stratCls</span><span class="p">)</span>
        <span class="n">scene</span><span class="o">.</span><span class="n">set_graph</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">observableGraph</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">scene</span>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="GraphListenerBase.make_scene"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.GraphListenerBase.make_scene">[docs]</a>    <span class="k">def</span> <span class="nf">make_scene</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</div>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">observer</span><span class="o">.</span><span class="n">AbstractListener</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c">#mappings from models to widgets</span>
        <span class="c">#used by cleanup (gc) procedures</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__widgetmap</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__graph</span>           <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__strategyCls</span>     <span class="o">=</span> <span class="bp">None</span>
        <span class="c">#obtaining types from the strategy.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_connector_types</span>  <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__observableGraph</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__graphAdapter</span>    <span class="o">=</span> <span class="bp">None</span>

        <span class="c">#low-level detail, during the edge creation we store</span>
        <span class="c">#the connectable graphical item closest to the mice.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currentItem</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c">#an edge currently being drawn,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__newEdge</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__newEdgeSource</span> <span class="o">=</span> <span class="bp">None</span>

<div class="viewcode-block" id="GraphListenerBase.get_strategy"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.GraphListenerBase.get_strategy">[docs]</a>    <span class="k">def</span> <span class="nf">get_strategy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__strategy</span>
</div>
<div class="viewcode-block" id="GraphListenerBase.set_strategy"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.GraphListenerBase.set_strategy">[docs]</a>    <span class="k">def</span> <span class="nf">set_strategy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stratCls</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__strategyCls</span> <span class="o">=</span> <span class="n">stratCls</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_connector_types</span> <span class="o">|=</span> <span class="nb">set</span><span class="p">(</span><span class="n">stratCls</span><span class="o">.</span><span class="n">get_connector_types</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="GraphListenerBase.get_graph"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.GraphListenerBase.get_graph">[docs]</a>    <span class="k">def</span> <span class="nf">get_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__graph</span>
</div>
<div class="viewcode-block" id="GraphListenerBase.set_graph"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.GraphListenerBase.set_graph">[docs]</a>    <span class="k">def</span> <span class="nf">set_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">adapter</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">observableGraph</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;graph already set, use .clear() method before&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__graph</span>           <span class="o">=</span> <span class="n">graph</span>
        <span class="c">#obtaining types from the strategy.</span>
        <span class="n">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__strategyCls</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__graphAdapter</span> <span class="o">=</span> <span class="n">adapter</span> <span class="k">if</span> <span class="n">adapter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> \
                              <span class="p">(</span><span class="n">graph</span> <span class="k">if</span> <span class="n">cls</span><span class="o">.</span><span class="n">__adapterType__</span> <span class="ow">is</span> <span class="bp">None</span> \
                               <span class="k">else</span> <span class="n">cls</span><span class="o">.</span><span class="n">__adapterType__</span><span class="p">(</span><span class="n">graph</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__observableGraph</span> <span class="o">=</span> <span class="n">graph</span> <span class="k">if</span> <span class="n">observableGraph</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">observableGraph</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__observableGraph</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__observableGraph</span><span class="o">.</span><span class="n">register_listener</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GraphListenerBase.get_adapter"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.GraphListenerBase.get_adapter">[docs]</a>    <span class="k">def</span> <span class="nf">get_adapter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__graphAdapter</span>
</div>
<div class="viewcode-block" id="GraphListenerBase.get_observable_graph"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.GraphListenerBase.get_observable_graph">[docs]</a>    <span class="k">def</span> <span class="nf">get_observable_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__observableGraph</span>
</div>
<div class="viewcode-block" id="GraphListenerBase.initialise_from_model"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.GraphListenerBase.initialise_from_model">[docs]</a>    <span class="k">def</span> <span class="nf">initialise_from_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_graph</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">g</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__strategyCls</span><span class="o">.</span><span class="n">initialise_graph_view</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__strategyCls</span><span class="o">.</span><span class="n">initialise_graph_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GraphListenerBase.clear"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.GraphListenerBase.clear">[docs]</a>    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__observableGraph</span><span class="o">.</span><span class="n">unregister_listener</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__graph</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__graphAdapter</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__observableGraph</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__widgetmap</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="c">#############################################################</span>
    <span class="c"># Observer methods come next. They DO NOT modify the model. #</span>
    <span class="c">#############################################################</span></div>
<div class="viewcode-block" id="GraphListenerBase.notify"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.GraphListenerBase.notify">[docs]</a>    <span class="k">def</span> <span class="nf">notify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sender</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">event</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">mainEvent</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">eventData</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span><span class="p">(</span><span class="n">mainEvent</span><span class="o">==</span><span class="s">&quot;vertex_added&quot;</span><span class="p">)</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertex_added</span><span class="p">(</span><span class="o">*</span><span class="n">eventData</span><span class="p">)</span>
        <span class="k">elif</span><span class="p">(</span><span class="n">mainEvent</span><span class="o">==</span><span class="s">&quot;edge_added&quot;</span><span class="p">)</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_added</span><span class="p">(</span><span class="o">*</span><span class="n">eventData</span><span class="p">)</span>
        <span class="k">elif</span><span class="p">(</span><span class="n">mainEvent</span><span class="o">==</span><span class="s">&quot;vertex_removed&quot;</span><span class="p">)</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertex_removed</span><span class="p">(</span><span class="o">*</span><span class="n">eventData</span><span class="p">)</span>
        <span class="k">elif</span><span class="p">(</span><span class="n">mainEvent</span><span class="o">==</span><span class="s">&quot;edge_removed&quot;</span><span class="p">)</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_removed</span><span class="p">(</span><span class="o">*</span><span class="n">eventData</span><span class="p">)</span>

        <span class="k">elif</span><span class="p">(</span><span class="n">mainEvent</span><span class="o">==</span><span class="s">&quot;vertex_event&quot;</span><span class="p">)</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertex_event</span><span class="p">(</span><span class="o">*</span><span class="n">eventData</span><span class="p">)</span>
        <span class="k">elif</span><span class="p">(</span><span class="n">mainEvent</span><span class="o">==</span><span class="s">&quot;edge_event&quot;</span><span class="p">)</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_event</span><span class="p">(</span><span class="o">*</span><span class="n">eventData</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GraphListenerBase.vertex_added"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.GraphListenerBase.vertex_added">[docs]</a>    <span class="k">def</span> <span class="nf">vertex_added</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vtype</span><span class="p">,</span> <span class="n">vertexModel</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">vertexModel</span> <span class="ow">is</span> <span class="bp">None</span> <span class="p">:</span> <span class="k">return</span>
        <span class="n">vertexWidget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__strategyCls</span><span class="o">.</span><span class="n">create_vertex_widget</span><span class="p">(</span><span class="n">vtype</span><span class="p">,</span> <span class="n">vertexModel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_graph</span><span class="p">(),</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_element_added</span><span class="p">(</span><span class="n">vertexWidget</span><span class="p">,</span> <span class="n">vertexModel</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="GraphListenerBase.edge_added"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.GraphListenerBase.edge_added">[docs]</a>    <span class="k">def</span> <span class="nf">edge_added</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">etype</span><span class="p">,</span> <span class="n">edgeModel</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">edgeModel</span> <span class="ow">is</span> <span class="bp">None</span> <span class="p">:</span> <span class="k">return</span>
        <span class="n">edgeWidget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__strategyCls</span><span class="o">.</span><span class="n">create_edge_widget</span><span class="p">(</span><span class="n">etype</span><span class="p">,</span> <span class="n">edgeModel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_graph</span><span class="p">(),</span>
                                                        <span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_element_added</span><span class="p">(</span><span class="n">edgeWidget</span><span class="p">,</span> <span class="n">edgeModel</span><span class="p">)</span>

        <span class="c"># needed to place the edge tips at the right position</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vertex_event</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="s">&quot;notify_position_change&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vertex_event</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="s">&quot;notify_position_change&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">w</span>

</div>
<div class="viewcode-block" id="GraphListenerBase.vertex_removed"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.GraphListenerBase.vertex_removed">[docs]</a>    <span class="k">def</span> <span class="nf">vertex_removed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vtype</span><span class="p">,</span> <span class="n">vertexModel</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">vertexModel</span> <span class="ow">is</span> <span class="bp">None</span> <span class="p">:</span> <span class="k">return</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_element_removed</span><span class="p">(</span><span class="n">vertexModel</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GraphListenerBase.edge_removed"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.GraphListenerBase.edge_removed">[docs]</a>    <span class="k">def</span> <span class="nf">edge_removed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vtype</span><span class="p">,</span> <span class="n">edgeModel</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">edgeModel</span> <span class="ow">is</span> <span class="bp">None</span> <span class="p">:</span> <span class="k">return</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_element_removed</span><span class="p">(</span><span class="n">edgeModel</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GraphListenerBase.vertex_event"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.GraphListenerBase.vertex_event">[docs]</a>    <span class="k">def</span> <span class="nf">vertex_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vertex</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">observers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__widgetmap</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">vertex</span><span class="p">),{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">vertex</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">observers</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">obs</span> <span class="ow">in</span> <span class="n">observers</span><span class="p">:</span>
                <span class="n">obs</span><span class="p">()</span><span class="o">.</span><span class="n">notify</span><span class="p">(</span><span class="n">vertex</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GraphListenerBase.edge_event"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.GraphListenerBase.edge_event">[docs]</a>    <span class="k">def</span> <span class="nf">edge_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edge</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">observers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__widgetmap</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">edge</span><span class="p">),{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">observers</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">obs</span> <span class="ow">in</span> <span class="n">observers</span><span class="p">:</span>
                <span class="n">obs</span><span class="p">()</span><span class="o">.</span><span class="n">notify</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>


    <span class="c">########################################################</span>
    <span class="c"># Controller methods come next. They MODIFY the model. #</span>
    <span class="c">########################################################</span></div>
<div class="viewcode-block" id="GraphListenerBase.new_vertex"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.GraphListenerBase.new_vertex">[docs]</a>    <span class="k">def</span> <span class="nf">new_vertex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__graphAdapter</span><span class="o">.</span><span class="n">new_vertex</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GraphListenerBase.add_vertex"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.GraphListenerBase.add_vertex">[docs]</a>    <span class="k">def</span> <span class="nf">add_vertex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__graphAdapter</span><span class="o">.</span><span class="n">add_vertex</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GraphListenerBase.get_vertex"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.GraphListenerBase.get_vertex">[docs]</a>    <span class="k">def</span> <span class="nf">get_vertex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__graphAdapter</span><span class="o">.</span><span class="n">get_vertex</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GraphListenerBase.remove_vertex"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.GraphListenerBase.remove_vertex">[docs]</a>    <span class="k">def</span> <span class="nf">remove_vertex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__graphAdapter</span><span class="o">.</span><span class="n">remove_vertex</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GraphListenerBase.remove_vertices"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.GraphListenerBase.remove_vertices">[docs]</a>    <span class="k">def</span> <span class="nf">remove_vertices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__graphAdapter</span><span class="o">.</span><span class="n">remove_vertices</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GraphListenerBase.get_vertex_inputs"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.GraphListenerBase.get_vertex_inputs">[docs]</a>    <span class="k">def</span> <span class="nf">get_vertex_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__graphAdapter</span><span class="o">.</span><span class="n">get_vertex_inputs</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GraphListenerBase.get_vertex_outputs"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.GraphListenerBase.get_vertex_outputs">[docs]</a>    <span class="k">def</span> <span class="nf">get_vertex_outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__graphAdapter</span><span class="o">.</span><span class="n">get_vertex_outputs</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GraphListenerBase.get_vertex_input"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.GraphListenerBase.get_vertex_input">[docs]</a>    <span class="k">def</span> <span class="nf">get_vertex_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__graphAdapter</span><span class="o">.</span><span class="n">get_vertex_input</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GraphListenerBase.get_vertex_output"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.GraphListenerBase.get_vertex_output">[docs]</a>    <span class="k">def</span> <span class="nf">get_vertex_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__graphAdapter</span><span class="o">.</span><span class="n">get_vertex_output</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GraphListenerBase.add_edge"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.GraphListenerBase.add_edge">[docs]</a>    <span class="k">def</span> <span class="nf">add_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__graphAdapter</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GraphListenerBase.remove_edge"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.GraphListenerBase.remove_edge">[docs]</a>    <span class="k">def</span> <span class="nf">remove_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__graphAdapter</span><span class="o">.</span><span class="n">remove_edge</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GraphListenerBase.remove_edges"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.GraphListenerBase.remove_edges">[docs]</a>    <span class="k">def</span> <span class="nf">remove_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__graphAdapter</span><span class="o">.</span><span class="n">remove_edges</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c">#########################</span>
    <span class="c"># Other utility methods #</span>
    <span class="c">#########################</span></div>
<div class="viewcode-block" id="GraphListenerBase.is_connectable"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.GraphListenerBase.is_connectable">[docs]</a>    <span class="k">def</span> <span class="nf">is_connectable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ct</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connector_types</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">ct</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="GraphListenerBase.is_input"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.GraphListenerBase.is_input">[docs]</a>    <span class="k">def</span> <span class="nf">is_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__graphAdapter</span><span class="o">.</span><span class="n">is_input</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GraphListenerBase.is_output"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.GraphListenerBase.is_output">[docs]</a>    <span class="k">def</span> <span class="nf">is_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__graphAdapter</span><span class="o">.</span><span class="n">is_output</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GraphListenerBase.get_vertex_types"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.GraphListenerBase.get_vertex_types">[docs]</a>    <span class="k">def</span> <span class="nf">get_vertex_types</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__graphAdapter</span><span class="o">.</span><span class="n">get_vertex_types</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="GraphListenerBase.get_edge_types"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.GraphListenerBase.get_edge_types">[docs]</a>    <span class="k">def</span> <span class="nf">get_edge_types</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__graphAdapter</span><span class="o">.</span><span class="n">get_edge_types</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="GraphListenerBase.get_graphical_edges_connected_to"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.GraphListenerBase.get_graphical_edges_connected_to">[docs]</a>    <span class="k">def</span> <span class="nf">get_graphical_edges_connected_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmodel</span><span class="p">):</span>
        <span class="n">edgeMap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__widgetmap</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&quot;edge&quot;</span><span class="p">,{})</span>
        <span class="n">retSet</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">edgeModel</span><span class="p">,</span> <span class="n">graphicalEdges</span> <span class="ow">in</span> <span class="n">edgeMap</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">edgeModel</span><span class="p">,</span> <span class="s">&quot;__iter__&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cmodel</span> <span class="ow">in</span> <span class="n">edgeModel</span><span class="p">:</span>
                <span class="n">retSet</span> <span class="o">|=</span> <span class="n">graphicalEdges</span>
            <span class="k">elif</span> <span class="n">edgeModel</span> <span class="o">==</span> <span class="n">cmodel</span><span class="p">:</span> <span class="c">#what???????</span>
                <span class="n">retSet</span> <span class="o">|=</span> <span class="n">graphicalEdges</span>
        <span class="k">return</span> <span class="n">retSet</span>


    <span class="c">###############################################################</span>
    <span class="c"># Internal book-keeping methods to make all system&#39;s gc happy #</span>
    <span class="c">###############################################################</span></div>
    <span class="k">def</span> <span class="nf">_element_added</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
        <span class="n">widget</span><span class="o">.</span><span class="n">add_to_view</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_scene</span><span class="p">())</span>
        <span class="n">widget</span><span class="o">.</span><span class="n">initialise_from_model</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_register_widget_with_model</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">widget</span>

    <span class="k">def</span> <span class="nf">_register_widget_with_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method maps widgets to models. A single model</span>
<span class="sd">        can be viewed be many widgets.</span>
<span class="sd">        Because it is very difficult to track ownership of</span>
<span class="sd">        widgets or models, GraphEditor tries to create only</span>
<span class="sd">        weak references to the widgets to reduce the risk of leaks</span>
<span class="sd">        comming from OS-specific memory management issues.</span>
<span class="sd">        The resulting mapping is used to cleanly remove widgets from</span>
<span class="sd">        the views when the model has been deleted.</span>
<span class="sd">        It uses the weakref callback to maintain the mapping up-to-date.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">model</span> <span class="ow">is</span> <span class="bp">None</span> <span class="p">:</span> <span class="k">return</span>
        <span class="n">t</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="n">widgetWeakRef</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_widget_died</span><span class="p">)</span>
        <span class="n">widgetTypeMap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__widgetmap</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">t</span><span class="p">,{})</span>
        <span class="n">modelWidgets</span> <span class="o">=</span> <span class="n">widgetTypeMap</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span>
        <span class="n">modelWidgets</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">widgetWeakRef</span><span class="p">)</span>
<span class="c">#        widgetTypeMap[widgetWeakRef] = model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__widgetmap</span><span class="p">[</span><span class="n">widgetWeakRef</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">post_addition</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span> <span class="c">#virtual function call</span>
        <span class="k">return</span> <span class="n">widget</span>

    <span class="k">def</span> <span class="nf">_element_removed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">model</span> <span class="ow">is</span> <span class="bp">None</span> <span class="p">:</span> <span class="k">return</span>
        <span class="n">t</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="n">widgets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__widgetmap</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">widgets</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span> <span class="k">return</span>
        <span class="k">for</span> <span class="n">widgetWeakRef</span> <span class="ow">in</span> <span class="n">widgets</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__widgetmap</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">widgetWeakRef</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="n">widget</span> <span class="o">=</span> <span class="n">widgetWeakRef</span><span class="p">()</span>
            <span class="n">widget</span><span class="o">.</span><span class="n">remove_from_view</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_scene</span><span class="p">())</span>
            <span class="k">del</span> <span class="n">widgetWeakRef</span>

    <span class="k">def</span> <span class="nf">_unregister_widget_from_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">model</span> <span class="ow">is</span> <span class="bp">None</span> <span class="p">:</span> <span class="k">return</span>
        <span class="n">t</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="n">widgets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__widgetmap</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">widgets</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span> <span class="k">return</span>
        <span class="n">toDiscard</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">for</span> <span class="n">widgetWeakRef</span> <span class="ow">in</span> <span class="n">widgets</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">widgetWeakRef</span><span class="p">()</span> <span class="o">==</span> <span class="n">widget</span> <span class="p">:</span> <span class="n">toDiscard</span> <span class="o">=</span> <span class="n">widgetWeakRef</span><span class="p">;</span> <span class="k">break</span>
        <span class="k">if</span> <span class="n">toDiscard</span><span class="p">:</span>
            <span class="n">widgets</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">toDiscard</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_widget_died</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widgetWeakRef</span><span class="p">):</span>
        <span class="c"># get the type associated with this weakref instance.</span>
        <span class="c"># this will let us get the set that contains this instance</span>
        <span class="c"># and that must be discarded.</span>
        <span class="c"># the type is mainly used as an accelerator.</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__widgetmap</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">widgetWeakRef</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">t</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__widgetmap</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">t</span><span class="p">,{})</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">widgetWeakRef</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">model</span><span class="p">:</span> <span class="k">return</span>
            <span class="c"># raise Exception(&quot;__widget_died without associated model&quot;)</span>
        <span class="n">modelWidgets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__widgetmap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">modelWidgets</span> <span class="p">:</span> <span class="k">return</span>
        <span class="n">modelWidgets</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">widgetWeakRef</span><span class="p">)</span>


    <span class="c">##################################################################</span>
    <span class="c"># Protected controller methods come next. They MODIFY the model. #</span>
    <span class="c">##################################################################</span>

    <span class="c">#---Low-Level Edge Interaction---</span>
    <span class="k">def</span> <span class="nf">_is_creating_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">True</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__newEdge</span> <span class="k">else</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">_new_edge_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">srcPt</span><span class="p">,</span> <span class="n">etype</span><span class="o">=</span><span class="s">&quot;default&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__newEdge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__strategyCls</span><span class="o">.</span><span class="n">create_edge_widget</span><span class="p">(</span><span class="s">&quot;floating-&quot;</span><span class="o">+</span><span class="n">etype</span><span class="p">,</span> <span class="n">srcPt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_graph</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__newEdge</span><span class="o">.</span><span class="n">add_to_view</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_scene</span><span class="p">())</span>
        <span class="k">if</span>  <span class="n">source</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__newEdgeSource</span> <span class="o">=</span> <span class="n">source</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__newEdgeSource</span><span class="o">.</span><span class="n">lock_position</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_new_edge_set_destination</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">dest</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentItem</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">currentItem</span><span class="o">.</span><span class="n">set_highlighted</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__newEdge</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">currentItem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_closest_connectable</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentItem</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">currentItem</span><span class="o">.</span><span class="n">set_highlighted</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
                <span class="n">dest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentItem</span><span class="o">.</span><span class="n">get_scene_center</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__newEdge</span><span class="o">.</span><span class="n">update_line_destination</span><span class="p">(</span><span class="o">*</span><span class="n">dest</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_new_edge_end</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__newEdge</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__newEdge</span><span class="o">.</span><span class="n">consolidate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_graph</span><span class="p">())</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span> <span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__newEdge</span><span class="o">.</span><span class="n">remove_from_view</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_scene</span><span class="p">())</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentItem</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">currentItem</span><span class="o">.</span><span class="n">set_highlighted</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">currentItem</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__newEdge</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__newEdgeSource</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__newEdgeSource</span><span class="o">.</span><span class="n">lock_position</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__newEdgeSource</span> <span class="o">=</span> <span class="bp">None</span>



</div>
<div class="viewcode-block" id="BlackBoxModel"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.BlackBoxModel">[docs]</a><span class="k">class</span> <span class="nc">BlackBoxModel</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An object that allows to unify certain model (in the MVC meaning) operations calls,</span>
<span class="sd">    wether the model is an Observed instance or just any random class.</span>

<span class="sd">    In the case it is an Observed instance, it calls the according methods of the model.</span>
<span class="sd">    In any other case, the implementation does (almost) nothing.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="n">observed</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="n">owner</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__observed</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__is_true</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__call__</span><span class="p">(</span><span class="n">observed</span><span class="p">)</span>

<div class="viewcode-block" id="BlackBoxModel.is_true"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.BlackBoxModel.is_true">[docs]</a>    <span class="k">def</span> <span class="nf">is_true</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__is_true</span>
</div>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;If args is provided, sets the args,</span>
<span class="sd">        else, returns the observed&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">observed</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">observed</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__observed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">return</span> <span class="c">#don&#39;t overwrite the existing observed</span>
                <span class="k">else</span> <span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">observed</span><span class="p">,</span> <span class="n">observer</span><span class="o">.</span><span class="n">Observed</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__patch_true</span><span class="p">()</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__patch_fake</span><span class="p">()</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__patch_fake</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__set_observed</span><span class="p">(</span><span class="n">observed</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_observed</span><span class="p">()</span>

<div class="viewcode-block" id="BlackBoxModel.clear_observed"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.BlackBoxModel.clear_observed">[docs]</a>    <span class="k">def</span> <span class="nf">clear_observed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;clear_obs : You first need to set the observed with the () operator&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="BlackBoxModel.get_observed"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.BlackBoxModel.get_observed">[docs]</a>    <span class="k">def</span> <span class="nf">get_observed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;get_obs : You first need to set the observed with the () operator&quot;</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">__set_observed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obs</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;set_obs : You first need to set the observed with the () operator&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="BlackBoxModel.get_observers"><a class="viewcode-back" href="../../../openalea/grapheditor/doc/user/autosum.html#openalea.grapheditor.baselisteners.BlackBoxModel.get_observers">[docs]</a>    <span class="k">def</span> <span class="nf">get_observers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;get_observers : You first need to set the observed with the () operator&quot;</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">__patch_true</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__is_true</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_observed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__clear_true_observed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_observed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_true_observed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_observers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_true_observers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__set_observed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__set_true_observed</span>

    <span class="k">def</span> <span class="nf">__patch_fake</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__is_true</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_observed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__clear_fake_observed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_observed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_fake_observed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_observers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_fake_observers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__set_observed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__set_fake_observed</span>

    <span class="k">def</span> <span class="nf">__set_true_observed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">owner</span><span class="p">()</span><span class="o">.</span><span class="n">initialise</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__observed</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">clear_observed</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__set_fake_observed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__observed</span> <span class="o">=</span> <span class="n">obs</span>

    <span class="k">def</span> <span class="nf">__get_true_observed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__observed</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__get_fake_observed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__observed</span>

    <span class="k">def</span> <span class="nf">__clear_true_observed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__observed</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__observed</span><span class="p">()</span><span class="o">.</span><span class="n">unregister_listener</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">owner</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__observed</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">__clear_fake_observed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__observed</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">__get_true_observers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__observed</span><span class="p">()</span><span class="o">.</span><span class="n">listeners</span>

    <span class="k">def</span> <span class="nf">__get_fake_observers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">None</span> <span class="c">#ugh... don&#39;t know how to do anything smart here yet.</span>
</pre></div></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">OpenAlea community website</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2014, INRIA VirtualPlants.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>