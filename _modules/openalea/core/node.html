<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>openalea.core.node &mdash; OpenAlea community website</title>
    
    <link rel="stylesheet" href="../../../_static/virtualplants.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="OpenAlea community website" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">OpenAlea community website</a> &raquo;</li>
          <li><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for openalea.core.node</h1><div class="highlight"><pre>
<span class="c"># -*- python -*-</span>
<span class="c">#</span>
<span class="c">#       OpenAlea.Core</span>
<span class="c">#</span>
<span class="c">#       Copyright 2006-2009 INRIA - CIRAD - INRA</span>
<span class="c">#</span>
<span class="c">#       File author(s): Samuel Dufour-Kowalski &lt;samuel.dufour@sophia.inria.fr&gt;</span>
<span class="c">#                       Christophe Pradal &lt;christophe.prada@cirad.fr&gt;</span>
<span class="c">#</span>
<span class="c">#       Distributed under the Cecill-C License.</span>
<span class="c">#       See accompanying file LICENSE.txt or copy at</span>
<span class="c">#           http://www.cecill.info/licences/Licence_CeCILL-C_V1-en.html</span>
<span class="c">#</span>
<span class="c">#       OpenAlea WebSite : http://openalea.gforge.inria.fr</span>
<span class="c">#</span>
<span class="c">###############################################################################</span>
<span class="sd">&quot;&quot;&quot;Node and NodeFactory classes.</span>

<span class="sd">A Node is generalized functor which is embeded in a dataflow.</span>
<span class="sd">A Factory build Node from its description. Factories instantiate</span>
<span class="sd">Nodes on demand for the dataflow.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">__license__</span> <span class="o">=</span> <span class="s">&quot;Cecill-C&quot;</span>
<span class="n">__revision__</span> <span class="o">=</span> <span class="s">&quot; $Id$ &quot;</span>

<span class="kn">import</span> <span class="nn">imp</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">types</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">copy</span><span class="p">,</span> <span class="n">deepcopy</span>
<span class="kn">from</span> <span class="nn">weakref</span> <span class="kn">import</span> <span class="n">ref</span><span class="p">,</span> <span class="n">proxy</span>

<span class="c"># from signature import get_parameters</span>
<span class="kn">import</span> <span class="nn">signature</span> <span class="kn">as</span> <span class="nn">sgn</span>
<span class="kn">from</span> <span class="nn">observer</span> <span class="kn">import</span> <span class="n">Observed</span><span class="p">,</span> <span class="n">AbstractListener</span>
<span class="kn">from</span> <span class="nn">actor</span> <span class="kn">import</span> <span class="n">IActor</span>
<span class="kn">from</span> <span class="nn">metadatadict</span> <span class="kn">import</span> <span class="n">MetaDataDict</span><span class="p">,</span> <span class="n">HasAdHoc</span>
<span class="kn">from</span> <span class="nn">interface</span> <span class="kn">import</span> <span class="n">TypeNameInterfaceMap</span>
<span class="c"># Exceptions</span>
<div class="viewcode-block" id="RecursionError"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.RecursionError">[docs]</a><span class="k">class</span> <span class="nc">RecursionError</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;todo&quot;&quot;&quot;</span>
    <span class="k">pass</span>

</div>
<div class="viewcode-block" id="InstantiationError"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.InstantiationError">[docs]</a><span class="k">class</span> <span class="nc">InstantiationError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;todo&quot;&quot;&quot;</span>
    <span class="k">pass</span>


<span class="c">########################</span>
<span class="c"># Node related classes #</span>
<span class="c">########################</span></div>
<div class="viewcode-block" id="AbstractNode"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.AbstractNode">[docs]</a><span class="k">class</span> <span class="nc">AbstractNode</span><span class="p">(</span><span class="n">Observed</span><span class="p">,</span> <span class="n">HasAdHoc</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An AbstractNode is the atomic entity in a dataflow.</span>

<span class="sd">    internal_data contains properties specified by users.</span>
<span class="sd">    They can be extended and the number is not fixed.</span>
<span class="sd">    We use a dict to distinguish these public properties to the others</span>
<span class="sd">    which are used for protected management.</span>

<span class="sd">    .. todo::</span>
<span class="sd">        - rename internal_data into attributes.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">mimetype</span> <span class="o">=</span> <span class="s">&quot;openalea/node&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Default Constructor</span>
<span class="sd">        Create Internal Data dictionnary</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">HasAdHoc</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">Observed</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__id</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c"># Internal Data (caption...)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">internal_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">factory</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="c"># -- the ugly back reference --</span>
        <span class="c"># !! Christophe, don&#39;t look at this one.</span>
        <span class="c"># proxy to higher level structure, aka CompositeNode.</span>
        <span class="c"># This is currently only used by the &quot;wrap_method&quot; node</span>
        <span class="c"># that needs to modify the topology of the graph.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_composite_node</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="c"># The default layout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_application</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__inError</span> <span class="o">=</span> <span class="bp">False</span>

<div class="viewcode-block" id="AbstractNode.get_id"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.AbstractNode.get_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__id</span>
</div>
<div class="viewcode-block" id="AbstractNode.set_id"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.AbstractNode.set_id">[docs]</a>    <span class="k">def</span> <span class="nf">set_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__id</span> <span class="o">=</span> <span class="nb">id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">internal_data</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__id</span>
</div>
    <span class="k">def</span> <span class="nf">_init_internal_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">internal_data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

    <span class="c"># -- the ugly back reference --</span>
<div class="viewcode-block" id="AbstractNode.set_compositenode"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.AbstractNode.set_compositenode">[docs]</a>    <span class="k">def</span> <span class="nf">set_compositenode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">upper</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_composite_node</span> <span class="o">=</span> <span class="n">proxy</span><span class="p">(</span><span class="n">upper</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractNode.set_data"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.AbstractNode.set_data">[docs]</a>    <span class="k">def</span> <span class="nf">set_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">notify</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set internal node data &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">internal_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">if</span><span class="p">(</span><span class="n">notify</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">notify_listeners</span><span class="p">((</span><span class="s">&quot;data_modified&quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="AbstractNode.close"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.AbstractNode.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">notify_listeners</span><span class="p">((</span><span class="s">&quot;close&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="AbstractNode.reset"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.AbstractNode.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Reset Node &quot;&quot;&quot;</span>
        <span class="k">pass</span>
</div>
<div class="viewcode-block" id="AbstractNode.reload"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.AbstractNode.reload">[docs]</a>    <span class="k">def</span> <span class="nf">reload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Reset Node &quot;&quot;&quot;</span>
        <span class="k">pass</span>
</div>
<div class="viewcode-block" id="AbstractNode.invalidate"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.AbstractNode.invalidate">[docs]</a>    <span class="k">def</span> <span class="nf">invalidate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Invalidate Node &quot;&quot;&quot;</span>
        <span class="k">pass</span>
</div>
<div class="viewcode-block" id="AbstractNode.set_factory"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.AbstractNode.set_factory">[docs]</a>    <span class="k">def</span> <span class="nf">set_factory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">factory</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the factory of the node (if any) &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">factory</span> <span class="o">=</span> <span class="n">factory</span>
</div>
<div class="viewcode-block" id="AbstractNode.get_factory"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.AbstractNode.get_factory">[docs]</a>    <span class="k">def</span> <span class="nf">get_factory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the factory of the node (if any) &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span>
</div>
<div class="viewcode-block" id="AbstractNode.get_raise_exception"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.AbstractNode.get_raise_exception">[docs]</a>    <span class="k">def</span> <span class="nf">get_raise_exception</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__inError</span>
</div>
<div class="viewcode-block" id="AbstractNode.set_raise_exception"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.AbstractNode.set_raise_exception">[docs]</a>    <span class="k">def</span> <span class="nf">set_raise_exception</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__inError</span> <span class="o">=</span> <span class="n">val</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">notify_listeners</span><span class="p">((</span><span class="s">&quot;exception_state_changed&quot;</span><span class="p">,</span> <span class="n">val</span><span class="p">))</span>
</div>
    <span class="n">raise_exception</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_raise_exception</span><span class="p">,</span> <span class="n">set_raise_exception</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="AbstractPort"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.AbstractPort">[docs]</a><span class="k">class</span> <span class="nc">AbstractPort</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">Observed</span><span class="p">,</span> <span class="n">HasAdHoc</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The class describing the ports.</span>
<span class="sd">    AbstractPort is a dict for historical reason.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vertex</span><span class="p">):</span>
        <span class="nb">dict</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">HasAdHoc</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">Observed</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">vertex</span> <span class="o">=</span> <span class="n">ref</span><span class="p">(</span><span class="n">vertex</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__id</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="nb">id</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

<div class="viewcode-block" id="AbstractPort.copy_to"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.AbstractPort.copy_to">[docs]</a>    <span class="k">def</span> <span class="nf">copy_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">other</span><span class="o">.</span><span class="n">get_ad_hoc_dict</span><span class="p">()</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_ad_hoc_dict</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transfer_listeners</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPort.get_id"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.AbstractPort.get_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__id</span>
</div>
<div class="viewcode-block" id="AbstractPort.set_id"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.AbstractPort.set_id">[docs]</a>    <span class="k">def</span> <span class="nf">set_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__id</span> <span class="o">=</span> <span class="nb">id</span>
</div>
<div class="viewcode-block" id="AbstractPort.get_desc"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.AbstractPort.get_desc">[docs]</a>    <span class="k">def</span> <span class="nf">get_desc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Gets default description &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;desc&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPort.get_default"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.AbstractPort.get_default">[docs]</a>    <span class="k">def</span> <span class="nf">get_default</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;todo&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;value&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPort.get_interface"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.AbstractPort.get_interface">[docs]</a>    <span class="k">def</span> <span class="nf">get_interface</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the interface  &quot;&quot;&quot;</span>
        <span class="n">interf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;interface&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">interf</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">TypeNameInterfaceMap</span><span class="p">()[</span><span class="n">interf</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">interf</span>
</div>
<div class="viewcode-block" id="AbstractPort.get_tip"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.AbstractPort.get_tip">[docs]</a>    <span class="k">def</span> <span class="nf">get_tip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_value</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the tool tip &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
        <span class="n">interface</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;interface&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">desc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;desc&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;value&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">iname</span> <span class="o">=</span> <span class="s">&#39;Any&#39;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">interface</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">iname</span> <span class="o">=</span> <span class="n">interface</span><span class="o">.</span><span class="n">__name__</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">iname</span> <span class="o">=</span> <span class="n">interface</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="n">iname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">interface</span><span class="p">)</span>

        <span class="c"># A way to avoid displaying too long strings.</span>
        <span class="n">comment</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">comment</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
            <span class="n">comment</span> <span class="o">=</span> <span class="n">comment</span><span class="p">[:</span><span class="mi">100</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39; ...&#39;</span>

        <span class="k">if</span> <span class="n">current_value</span> <span class="ow">is</span> <span class="bp">None</span> <span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">(</span><span class="si">%s</span><span class="s">): </span><span class="si">%s</span><span class="s"> [default=</span><span class="si">%s</span><span class="s">] &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">iname</span><span class="p">,</span> <span class="n">desc</span><span class="p">,</span> <span class="n">comment</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">(</span><span class="si">%s</span><span class="s">): </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">iname</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">current_value</span><span class="p">))</span>

</div></div>
<div class="viewcode-block" id="InputPort"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.InputPort">[docs]</a><span class="k">class</span> <span class="nc">InputPort</span><span class="p">(</span><span class="n">AbstractPort</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; The class describing the input ports &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="n">AbstractPort</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>

<div class="viewcode-block" id="InputPort.get_label"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.InputPort.get_label">[docs]</a>    <span class="k">def</span> <span class="nf">get_label</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets default label&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;label&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="InputPort.is_hidden"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.InputPort.is_hidden">[docs]</a>    <span class="k">def</span> <span class="nf">is_hidden</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;True if the port should not be displayed.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;hide&quot;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="OutputPort"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.OutputPort">[docs]</a><span class="k">class</span> <span class="nc">OutputPort</span><span class="p">(</span><span class="n">AbstractPort</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The class describing the output ports &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="n">AbstractPort</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Annotation"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.Annotation">[docs]</a><span class="k">class</span> <span class="nc">Annotation</span><span class="p">(</span><span class="n">AbstractNode</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">AbstractNode</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<div class="viewcode-block" id="Annotation.to_script"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.Annotation.to_script">[docs]</a>    <span class="k">def</span> <span class="nf">to_script</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Script translation of this node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s">&quot;&quot;</span>
</div></div>
<div class="viewcode-block" id="Node"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.Node">[docs]</a><span class="k">class</span> <span class="nc">Node</span><span class="p">(</span><span class="n">AbstractNode</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    It is a callable object with typed inputs and outputs.</span>
<span class="sd">    Inputs and Outpus are indexed by their position or by a name (str)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Node.is_deprecated_event"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.Node.is_deprecated_event">[docs]</a>    <span class="k">def</span> <span class="nf">is_deprecated_event</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
        <span class="n">evLen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="n">conversionTxt</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">retEvent</span> <span class="o">=</span> <span class="n">event</span>
        <span class="k">if</span> <span class="n">evLen</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">event</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;caption_modified&quot;</span><span class="p">:</span>
                <span class="n">retEvent</span> <span class="o">=</span> <span class="s">&quot;data_modified&quot;</span><span class="p">,</span> <span class="s">&quot;caption&quot;</span><span class="p">,</span> <span class="n">event</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">conversionTxt</span> <span class="o">=</span> <span class="s">&quot;(&#39;data_modified&#39;, &#39;caption&#39;, caption)&quot;</span>
        <span class="k">elif</span> <span class="n">evLen</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">event</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;data_modified&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">event</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;delay&quot;</span><span class="p">:</span>
                    <span class="n">retEvent</span> <span class="o">=</span> <span class="s">&quot;internal_state_changed&quot;</span><span class="p">,</span> <span class="s">&quot;delay&quot;</span><span class="p">,</span> <span class="n">event</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                    <span class="n">conversionTxt</span> <span class="o">=</span> <span class="s">&quot;(&#39;internal_state_changed&#39;, &#39;delay&#39;, delay)&quot;</span>
            <span class="k">elif</span> <span class="n">event</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;internal_data_changed&quot;</span><span class="p">:</span>
                <span class="n">retEvent</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;internal_state_changed&#39;</span><span class="p">,</span> <span class="n">event</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">event</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">conversionTxt</span> <span class="o">=</span> <span class="s">&quot;(&#39;internal_state_changed&#39;, &#39;key&#39;, value)&quot;</span>
        <span class="k">return</span> <span class="n">conversionTxt</span><span class="p">,</span> <span class="n">retEvent</span>
</div>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="p">(),</span> <span class="n">outputs</span><span class="o">=</span><span class="p">()):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param inputs: list of dict(name=&#39;X&#39;, interface=IFloat, value=0)</span>
<span class="sd">        :param outputs: list of dict(name=&#39;X&#39;, interface=IFloat)</span>

<span class="sd">        .. note::</span>
<span class="sd">            if IO names are not a string, they will be converted with str()</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">AbstractNode</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_inputs</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_outputs</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_io</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="p">)</span>

        <span class="c"># Node State</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modified</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="c"># Internal Data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">internal_data</span><span class="p">[</span><span class="s">&quot;caption&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;&#39;</span> <span class="c"># str(self.__class__.__name__)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">internal_data</span><span class="p">[</span><span class="s">&quot;lazy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">internal_data</span><span class="p">[</span><span class="s">&quot;block&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span> <span class="c"># Do not evaluate the node</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">internal_data</span><span class="p">[</span><span class="s">&quot;priority&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">internal_data</span><span class="p">[</span><span class="s">&quot;hide&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span> <span class="c"># hide in composite node widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">internal_data</span><span class="p">[</span><span class="s">&quot;port_hide_changed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="c"># Add delay</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">internal_data</span><span class="p">[</span><span class="s">&quot;delay&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c"># Observed object to notify final nodes wich are continuously evaluated</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">continuous_eval</span> <span class="o">=</span> <span class="n">Observed</span><span class="p">()</span>

<div class="viewcode-block" id="Node.notify_listeners"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.Node.notify_listeners">[docs]</a>    <span class="k">def</span> <span class="nf">notify_listeners</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="n">txt</span><span class="p">,</span> <span class="n">trevent</span> <span class="o">=</span> <span class="n">Node</span><span class="o">.</span><span class="n">is_deprecated_event</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">txt</span><span class="p">:</span>
            <span class="n">Observed</span><span class="o">.</span><span class="n">notify_listeners</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trevent</span><span class="p">)</span>
            <span class="n">Observed</span><span class="o">.</span><span class="n">notify_listeners</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Observed</span><span class="o">.</span><span class="n">notify_listeners</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="p">()):</span>
        <span class="sd">&quot;&quot;&quot; Call function. Must be overriden &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

<div class="viewcode-block" id="Node.get_tip"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.Node.get_tip">[docs]</a>    <span class="k">def</span> <span class="nf">get_tip</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__doc__</span>
</div>
<div class="viewcode-block" id="Node.copy_to"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.Node.copy_to">[docs]</a>    <span class="k">def</span> <span class="nf">copy_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="c"># we copy some attributes.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transfer_listeners</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="c"># other.internal_data.update(self.internal_data)</span>
        <span class="n">other</span><span class="o">.</span><span class="n">get_ad_hoc_dict</span><span class="p">()</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_ad_hoc_dict</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">portOld</span><span class="p">,</span> <span class="n">portNew</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_desc</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_desc</span><span class="p">,</span>
                                    <span class="n">other</span><span class="o">.</span><span class="n">input_desc</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">output_desc</span><span class="p">):</span>
            <span class="n">portOld</span><span class="o">.</span><span class="n">copy_to</span><span class="p">(</span><span class="n">portNew</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Node.get_process_obj"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.Node.get_process_obj">[docs]</a>    <span class="k">def</span> <span class="nf">get_process_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the process obj &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="c"># property</span></div>
    <span class="n">process_obj</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_process_obj</span><span class="p">)</span>

<div class="viewcode-block" id="Node.set_factory"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.Node.set_factory">[docs]</a>    <span class="k">def</span> <span class="nf">set_factory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">factory</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the factory of the node (if any)</span>
<span class="sd">        and uptdate caption &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">factory</span> <span class="o">=</span> <span class="n">factory</span>
        <span class="k">if</span> <span class="n">factory</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_caption</span><span class="p">(</span><span class="n">factory</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Node.get_input_port"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.Node.get_input_port">[docs]</a>    <span class="k">def</span> <span class="nf">get_input_port</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets port by name.</span>

<span class="sd">        Long description of the function functionality.</span>

<span class="sd">        :param name: the name of the port</span>
<span class="sd">        :type name: string</span>
<span class="sd">        :returns: Input port characterized by name</span>
<span class="sd">        :rtype: InputPort</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_index_in</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_desc</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

    <span class="c">##############</span>
    <span class="c"># Properties #</span>
    <span class="c">##############</span></div>
<div class="viewcode-block" id="Node.get_lazy"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.Node.get_lazy">[docs]</a>    <span class="k">def</span> <span class="nf">get_lazy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;todo&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">internal_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;lazy&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Node.set_lazy"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.Node.set_lazy">[docs]</a>    <span class="k">def</span> <span class="nf">set_lazy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;todo&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">internal_data</span><span class="p">[</span><span class="s">&quot;lazy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">notify_listeners</span><span class="p">((</span><span class="s">&quot;internal_data_changed&quot;</span><span class="p">,</span> <span class="s">&quot;lazy&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>
</div>
    <span class="n">lazy</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_lazy</span><span class="p">,</span> <span class="n">set_lazy</span><span class="p">)</span>

<div class="viewcode-block" id="Node.get_delay"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.Node.get_delay">[docs]</a>    <span class="k">def</span> <span class="nf">get_delay</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;todo&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">internal_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;delay&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Node.set_delay"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.Node.set_delay">[docs]</a>    <span class="k">def</span> <span class="nf">set_delay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delay</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;todo&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">internal_data</span><span class="p">[</span><span class="s">&quot;delay&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">delay</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">notify_listeners</span><span class="p">((</span><span class="s">&quot;internal_data_changed&quot;</span><span class="p">,</span> <span class="s">&quot;delay&quot;</span><span class="p">,</span> <span class="n">delay</span><span class="p">))</span>
</div>
    <span class="n">delay</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_delay</span><span class="p">,</span> <span class="n">set_delay</span><span class="p">)</span>

<div class="viewcode-block" id="Node.get_block"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.Node.get_block">[docs]</a>    <span class="k">def</span> <span class="nf">get_block</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;todo&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">internal_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;block&quot;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Node.set_block"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.Node.set_block">[docs]</a>    <span class="k">def</span> <span class="nf">set_block</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;todo&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">internal_data</span><span class="p">[</span><span class="s">&quot;block&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">notify_listeners</span><span class="p">((</span><span class="s">&quot;internal_data_changed&quot;</span><span class="p">,</span> <span class="s">&quot;blocked&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>
</div>
    <span class="n">block</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_block</span><span class="p">,</span> <span class="n">set_block</span><span class="p">)</span>

<div class="viewcode-block" id="Node.get_user_application"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.Node.get_user_application">[docs]</a>    <span class="k">def</span> <span class="nf">get_user_application</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;todo&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">internal_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;user_application&quot;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Node.set_user_application"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.Node.set_user_application">[docs]</a>    <span class="k">def</span> <span class="nf">set_user_application</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;todo&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">internal_data</span><span class="p">[</span><span class="s">&quot;user_application&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">notify_listeners</span><span class="p">((</span><span class="s">&quot;internal_data_changed&quot;</span><span class="p">,</span> <span class="s">&quot;user_application&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>
</div>
    <span class="n">user_application</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_user_application</span><span class="p">,</span> <span class="n">set_user_application</span><span class="p">)</span>

<div class="viewcode-block" id="Node.set_caption"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.Node.set_caption">[docs]</a>    <span class="k">def</span> <span class="nf">set_caption</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newcaption</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Define the node caption &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">internal_data</span><span class="p">[</span><span class="s">&#39;caption&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newcaption</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">notify_listeners</span><span class="p">((</span><span class="s">&quot;caption_modified&quot;</span><span class="p">,</span> <span class="n">newcaption</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Node.get_caption"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.Node.get_caption">[docs]</a>    <span class="k">def</span> <span class="nf">get_caption</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the node caption &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">internal_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;caption&#39;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
</div>
    <span class="n">caption</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_caption</span><span class="p">,</span> <span class="n">set_caption</span><span class="p">)</span>

<div class="viewcode-block" id="Node.is_port_hidden"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.Node.is_port_hidden">[docs]</a>    <span class="k">def</span> <span class="nf">is_port_hidden</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index_key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the hidden state of a port &quot;&quot;&quot;</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_index_in</span><span class="p">[</span><span class="n">index_key</span><span class="p">]</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_desc</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">is_hidden</span><span class="p">()</span> <span class="c"># get(&#39;hide&#39;, False)</span>
        <span class="n">changed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">internal_data</span><span class="p">[</span><span class="s">&quot;port_hide_changed&quot;</span><span class="p">]</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">changed</span>

        <span class="k">if</span><span class="p">(</span><span class="n">index</span> <span class="ow">in</span> <span class="n">changed</span><span class="p">):</span>
            <span class="k">return</span> <span class="ow">not</span> <span class="n">s</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">s</span>
</div>
<div class="viewcode-block" id="Node.set_port_hidden"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.Node.set_port_hidden">[docs]</a>    <span class="k">def</span> <span class="nf">set_port_hidden</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index_key</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the hidden state of a port.</span>

<span class="sd">        :param index_key: the input port index.</span>
<span class="sd">        :param state: a boolean value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_index_in</span><span class="p">[</span><span class="n">index_key</span><span class="p">]</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_desc</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">is_hidden</span><span class="p">()</span> <span class="c"># get(&#39;hide&#39;, False)</span>

        <span class="n">changed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">internal_data</span><span class="p">[</span><span class="s">&quot;port_hide_changed&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">s</span> <span class="o">!=</span> <span class="n">state</span><span class="p">):</span>
            <span class="n">changed</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input_desc</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">get_ad_hoc_dict</span><span class="p">()</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s">&quot;hide&quot;</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">notify_listeners</span><span class="p">((</span><span class="s">&quot;hiddenPortChange&quot;</span><span class="p">,))</span>
        <span class="k">elif</span><span class="p">(</span><span class="n">index</span> <span class="ow">in</span> <span class="n">changed</span><span class="p">):</span>
            <span class="n">changed</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input_desc</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">get_ad_hoc_dict</span><span class="p">()</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s">&quot;hide&quot;</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">notify_listeners</span><span class="p">((</span><span class="s">&quot;hiddenPortChange&quot;</span><span class="p">,))</span>


    <span class="c"># Status</span></div>
<div class="viewcode-block" id="Node.unvalidate_input"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.Node.unvalidate_input">[docs]</a>    <span class="k">def</span> <span class="nf">unvalidate_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index_key</span><span class="p">,</span> <span class="n">notify</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Unvalidate node and notify listeners.</span>

<span class="sd">        This method is called when the input value has changed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modified</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_index_in</span><span class="p">[</span><span class="n">index_key</span><span class="p">]</span>
        <span class="k">if</span><span class="p">(</span><span class="n">notify</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">notify_listeners</span><span class="p">((</span><span class="s">&quot;input_modified&quot;</span><span class="p">,</span> <span class="n">index</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">continuous_eval</span><span class="o">.</span><span class="n">notify_listeners</span><span class="p">((</span><span class="s">&quot;node_modified&quot;</span><span class="p">,))</span>

    <span class="c"># Declarations</span></div>
<div class="viewcode-block" id="Node.set_io"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.Node.set_io">[docs]</a>    <span class="k">def</span> <span class="nf">set_io</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define the number of inputs and outputs</span>

<span class="sd">        :param inputs: list of dict(name=&#39;X&#39;, interface=IFloat, value=0)</span>
<span class="sd">        :param outputs: list of dict(name=&#39;X&#39;, interface=IFloat)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># # Values</span>
        <span class="k">if</span><span class="p">(</span><span class="n">inputs</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear_inputs</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">inputs</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_input</span><span class="p">(</span><span class="o">**</span><span class="n">d</span><span class="p">)</span>

        <span class="k">if</span><span class="p">(</span><span class="n">outputs</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">outputs</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear_outputs</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">outputs</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">outputs</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="o">**</span><span class="n">d</span><span class="p">)</span>

        <span class="c"># to_script</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_to_script_func</span> <span class="o">=</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="Node.clear_inputs"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.Node.clear_inputs">[docs]</a>    <span class="k">def</span> <span class="nf">clear_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c"># Description (list of dict (name=, interface=, ...))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_desc</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c"># translation of name to id or id to id (identity)...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map_index_in</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c"># Input states : &quot;connected&quot;, &quot;hidden&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_states</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">notify_listeners</span><span class="p">((</span><span class="s">&quot;cleared_input_ports&quot;</span><span class="p">,))</span>
</div>
<div class="viewcode-block" id="Node.clear_outputs"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.Node.clear_outputs">[docs]</a>    <span class="k">def</span> <span class="nf">clear_outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c"># Description (list of dict (name=, interface=, ...))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_desc</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c"># translation of name to id or id to id (identity)...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map_index_out</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">notify_listeners</span><span class="p">((</span><span class="s">&quot;cleared_output_ports&quot;</span><span class="p">,))</span>

</div>
<div class="viewcode-block" id="Node.add_input"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.Node.add_input">[docs]</a>    <span class="k">def</span> <span class="nf">add_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Create an input port &quot;&quot;&quot;</span>

        <span class="c"># Get parameters</span>
        <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">kargs</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">])</span>
        <span class="n">interface</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;interface&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

        <span class="c"># default value</span>
        <span class="k">if</span><span class="p">(</span><span class="n">interface</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">kargs</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;value&#39;</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">interface</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="c"># Create mapping between interface name and interface class</span>
                <span class="kn">from</span> <span class="nn">openalea.core.interface</span> <span class="kn">import</span> <span class="n">TypeNameInterfaceMap</span>
                <span class="n">interface</span> <span class="o">=</span> <span class="n">TypeNameInterfaceMap</span><span class="p">()[</span><span class="n">interface</span><span class="p">]</span>
                <span class="n">kargs</span><span class="p">[</span><span class="s">&#39;interface&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">interface</span>

            <span class="n">value</span> <span class="o">=</span> <span class="n">interface</span><span class="o">.</span><span class="n">default</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;value&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

        <span class="n">value</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="c"># force to have a string</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>

        <span class="n">port</span> <span class="o">=</span> <span class="n">InputPort</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">port</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_desc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">input_states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map_index_in</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map_index_in</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span>
        <span class="n">port</span><span class="o">.</span><span class="n">set_id</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_input</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="n">port</span><span class="o">.</span><span class="n">get_ad_hoc_dict</span><span class="p">()</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s">&quot;hide&quot;</span><span class="p">,</span>
                                            <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;hide&quot;</span><span class="p">,</span> <span class="bp">False</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">notify_listeners</span><span class="p">((</span><span class="s">&quot;input_port_added&quot;</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">port</span>
</div>
<div class="viewcode-block" id="Node.add_output"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.Node.add_output">[docs]</a>    <span class="k">def</span> <span class="nf">add_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Create an output port &quot;&quot;&quot;</span>

        <span class="c"># Get parameters</span>
        <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">kargs</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>

        <span class="n">port</span> <span class="o">=</span> <span class="n">OutputPort</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">port</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_desc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map_index_out</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map_index_out</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span>
        <span class="n">port</span><span class="o">.</span><span class="n">set_id</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">notify_listeners</span><span class="p">((</span><span class="s">&quot;output_port_added&quot;</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">port</span>

    <span class="c"># I/O Functions</span>
</div>
<div class="viewcode-block" id="Node.set_input"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.Node.set_input">[docs]</a>    <span class="k">def</span> <span class="nf">set_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">notify</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define the input value for the specified index/key</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_index_in</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

        <span class="n">changed</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lazy</span><span class="p">):</span>
            <span class="c"># Test if the inputs has changed</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">changed</span> <span class="o">=</span> <span class="p">(</span><span class="nb">cmp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">val</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">if</span><span class="p">(</span><span class="n">changed</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unvalidate_input</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">notify</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Node.set_output"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.Node.set_output">[docs]</a>    <span class="k">def</span> <span class="nf">set_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define the input value for the specified index/key</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_index_out</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">notify_listeners</span><span class="p">((</span><span class="s">&quot;output_modified&quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Node.output"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.Node.output">[docs]</a>    <span class="k">def</span> <span class="nf">output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_output</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Node.get_input"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.Node.get_input">[docs]</a>    <span class="k">def</span> <span class="nf">get_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index_key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the input value for the specified index/key &quot;&quot;&quot;</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_index_in</span><span class="p">[</span><span class="n">index_key</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Node.get_output"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.Node.get_output">[docs]</a>    <span class="k">def</span> <span class="nf">get_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index_key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the output for the specified index/key &quot;&quot;&quot;</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_index_out</span><span class="p">[</span><span class="n">index_key</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Node.get_input_state"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.Node.get_input_state">[docs]</a>    <span class="k">def</span> <span class="nf">get_input_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index_key</span><span class="p">):</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_index_in</span><span class="p">[</span><span class="n">index_key</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_states</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Node.set_input_state"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.Node.set_input_state">[docs]</a>    <span class="k">def</span> <span class="nf">set_input_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index_key</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the state of the input index/key (state is a string) &quot;&quot;&quot;</span>

        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_index_in</span><span class="p">[</span><span class="n">index_key</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_states</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unvalidate_input</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Node.get_nb_input"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.Node.get_nb_input">[docs]</a>    <span class="k">def</span> <span class="nf">get_nb_input</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the nb of input ports &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Node.get_nb_output"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.Node.get_nb_output">[docs]</a>    <span class="k">def</span> <span class="nf">get_nb_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the nb of output ports &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">)</span>

    <span class="c"># Functions used by the node evaluator</span>
</div>
<div class="viewcode-block" id="Node.eval"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.Node.eval">[docs]</a>    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Evaluate the node by calling __call__</span>
<span class="sd">        Return True if the node needs a reevaluation</span>
<span class="sd">        and a timed delay if the node needs a reevaluation at a later time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># lazy evaluation</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nb_output</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delay</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">lazy</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">modified</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">notify_listeners</span><span class="p">((</span><span class="s">&quot;start_eval&quot;</span><span class="p">,))</span>

        <span class="c"># Run the node</span>
        <span class="n">outlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__call__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">)</span>

        <span class="c"># Copy outputs</span>
        <span class="c"># only one output</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">outlist</span><span class="p">,</span> <span class="s">&quot;__getitem__&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">outlist</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">outlist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">outlist</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">outlist</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">output_desc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">notify_listeners</span><span class="p">((</span><span class="s">&quot;tooltip_modified&quot;</span><span class="p">,))</span>

        <span class="k">else</span><span class="p">:</span> <span class="c"># multi output</span>
            <span class="k">if</span><span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">outlist</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span>
               <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">outlist</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
                <span class="n">outlist</span> <span class="o">=</span> <span class="p">(</span><span class="n">outlist</span><span class="p">,)</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">outlist</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">))):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">output_desc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">notify_listeners</span><span class="p">((</span><span class="s">&quot;tooltip_modified&quot;</span><span class="p">,))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">outlist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="c"># Set State</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modified</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">notify_listeners</span><span class="p">((</span><span class="s">&quot;stop_eval&quot;</span><span class="p">,))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">delay</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">delay</span>
</div>
    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Pickle function : remove not saved data&quot;&quot;&quot;</span>

        <span class="n">odict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">odict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">AbstractNode</span><span class="o">.</span><span class="n">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

        <span class="n">odict</span><span class="p">[</span><span class="s">&#39;modified&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>


        <span class="n">outputs</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_nb_output</span><span class="p">()):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">outputs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">outputs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">odict</span><span class="p">[</span><span class="s">&#39;outputs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">outputs</span>

        <span class="n">inputs</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_nb_input</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_nb_input</span><span class="p">()):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">inputs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">inputs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">odict</span><span class="p">[</span><span class="s">&#39;inputs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inputs</span>

        <span class="n">in_ports</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">out_ports</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">port</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_desc</span><span class="p">):</span>
            <span class="n">port</span><span class="o">.</span><span class="n">vertex</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">in_ports</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">copy</span><span class="p">(</span><span class="n">port</span><span class="p">))</span>
            <span class="n">port</span><span class="o">.</span><span class="n">vertex</span> <span class="o">=</span> <span class="n">ref</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">port</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_desc</span><span class="p">):</span>
            <span class="n">port</span><span class="o">.</span><span class="n">vertex</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">out_ports</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">copy</span><span class="p">(</span><span class="n">port</span><span class="p">))</span>
            <span class="n">port</span><span class="o">.</span><span class="n">vertex</span> <span class="o">=</span> <span class="n">ref</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="n">odict</span><span class="p">[</span><span class="s">&#39;input_desc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">in_ports</span>
        <span class="n">odict</span><span class="p">[</span><span class="s">&#39;output_desc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">out_ports</span>

        <span class="k">return</span> <span class="n">odict</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">port</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_desc</span><span class="p">:</span>
            <span class="n">port</span><span class="o">.</span><span class="n">vertex</span> <span class="o">=</span> <span class="n">ref</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">port</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_desc</span><span class="p">:</span>
            <span class="n">port</span><span class="o">.</span><span class="n">vertex</span> <span class="o">=</span> <span class="n">ref</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<div class="viewcode-block" id="Node.reload"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.Node.reload">[docs]</a>    <span class="k">def</span> <span class="nf">reload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Reset ports &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_nb_output</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nb_input</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="c"># if(not connected or self.input_states[i] is &quot;connected&quot;):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_input</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_desc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;value&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>

        <span class="k">if</span><span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">invalidate</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Node.reset"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.Node.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Reset ports &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_nb_output</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nb_input</span><span class="p">()</span>

        <span class="k">if</span><span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">invalidate</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Node.invalidate"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.Node.invalidate">[docs]</a>    <span class="k">def</span> <span class="nf">invalidate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Invalidate node &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">modified</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">notify_listeners</span><span class="p">((</span><span class="s">&quot;input_modified&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">continuous_eval</span><span class="o">.</span><span class="n">notify_listeners</span><span class="p">((</span><span class="s">&quot;node_modified&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>

<span class="c"># X     @property</span>
<span class="c"># X     def outputs(self):</span>
<span class="c"># X         return [self.output(i) for i in range(self.get_nb_output())]</span>
</div>
<div class="viewcode-block" id="Node.to_script"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.Node.to_script">[docs]</a>    <span class="k">def</span> <span class="nf">to_script</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Script translation of this node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_script_func</span> <span class="ow">is</span> <span class="bp">None</span> <span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;#node </span><span class="si">%s</span><span class="s"> do not define any scripting</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">name</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_script_func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="FuncNode"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.FuncNode">[docs]</a><span class="k">class</span> <span class="nc">FuncNode</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Node with external function or function &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param inputs: list of dict(name=&#39;X&#39;, interface=IFloat, value=0)</span>
<span class="sd">        :param outputs: list of dict(name=&#39;X&#39;, interface=IFloat)</span>
<span class="sd">        :param func: A function</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">Node</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="n">func</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">__doc__</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="p">()):</span>
        <span class="sd">&quot;&quot;&quot; Call function. Must be overriden &quot;&quot;&quot;</span>
        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">inputs</span><span class="p">)</span>

<div class="viewcode-block" id="FuncNode.get_process_obj"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.FuncNode.get_process_obj">[docs]</a>    <span class="k">def</span> <span class="nf">get_process_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the process obj &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span>
</div>
    <span class="n">process_obj</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_process_obj</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="AbstractFactory"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.AbstractFactory">[docs]</a><span class="k">class</span> <span class="nc">AbstractFactory</span><span class="p">(</span><span class="n">Observed</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Abstract Factory is Factory base class</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">mimetype</span> <span class="o">=</span> <span class="s">&quot;openalea/nodefactory&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">name</span><span class="p">,</span>
                 <span class="n">description</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span>
                 <span class="n">category</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span>
                 <span class="n">inputs</span><span class="o">=</span><span class="p">(),</span>
                 <span class="n">outputs</span><span class="o">=</span><span class="p">(),</span>
                 <span class="n">lazy</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                 <span class="n">delay</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                 <span class="n">view</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">alias</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">authors</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a factory.</span>

<span class="sd">        :param name: user name for the node (must be unique) (String)</span>
<span class="sd">        :param description: description of the node (String)</span>
<span class="sd">        :param category: category of the node (String)</span>
<span class="sd">        :param inputs: inputs description</span>
<span class="sd">        :param outputs: outputs description, value=0</span>
<span class="sd">        :param lazy: enable lazy evaluation (default = False)</span>
<span class="sd">        :param view: custom view (default = None)</span>
<span class="sd">        :param alias: list of alias name</span>
<span class="sd">        :param authors: authors of the node. If Node, it should be replaced by the package authors.</span>

<span class="sd">        .. note:: inputs and outputs parameters are list of dictionnary such</span>

<span class="sd">        inputs = (dict(name=&#39;x&#39;, interface=IInt, value=0,)</span>
<span class="sd">        outputs = (dict(name=&#39;y&#39;, interface=IInt)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Observed</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c"># Factory info</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">category</span> <span class="o">=</span> <span class="n">category</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__pkg__</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__pkg_id__</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="o">=</span> <span class="n">inputs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span> <span class="o">=</span> <span class="n">outputs</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lazy</span> <span class="o">=</span> <span class="n">lazy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span> <span class="o">=</span> <span class="n">view</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delay</span> <span class="o">=</span> <span class="n">delay</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alias</span> <span class="o">=</span> <span class="n">alias</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">authors</span> <span class="o">=</span> <span class="n">authors</span>
    <span class="c"># Package property</span>

<div class="viewcode-block" id="AbstractFactory.set_pkg"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.AbstractFactory.set_pkg">[docs]</a>    <span class="k">def</span> <span class="nf">set_pkg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        An openalea package contains factories.</span>
<span class="sd">        The factory has a link to this package (weakref).</span>
<span class="sd">        The package id is the name of the package when the package is the</span>
<span class="sd">        Python object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span><span class="p">(</span><span class="ow">not</span> <span class="n">port</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__pkg__</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__pkg_id</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__pkg__</span> <span class="o">=</span> <span class="n">ref</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__pkg_id__</span> <span class="o">=</span> <span class="n">port</span><span class="o">.</span><span class="n">get_id</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">port</span>
</div>
<div class="viewcode-block" id="AbstractFactory.get_pkg"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.AbstractFactory.get_pkg">[docs]</a>    <span class="k">def</span> <span class="nf">get_pkg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;todo&quot;&quot;&quot;</span>
        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__pkg__</span><span class="p">):</span>
            <span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pkg__</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">port</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c"># Test if pkg has been reloaded</span>
        <span class="c"># In this case the weakref is not valid anymore</span>
        <span class="k">if</span><span class="p">(</span><span class="ow">not</span> <span class="n">port</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pkg_id__</span><span class="p">):</span>
            <span class="kn">from</span> <span class="nn">openalea.core.pkgmanager</span> <span class="kn">import</span> <span class="n">PackageManager</span>
            <span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_pkg</span><span class="p">(</span><span class="n">PackageManager</span><span class="p">()[</span><span class="bp">self</span><span class="o">.</span><span class="n">__pkg_id__</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">port</span>
</div>
    <span class="n">package</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_pkg</span><span class="p">,</span> <span class="n">set_pkg</span><span class="p">)</span>

<div class="viewcode-block" id="AbstractFactory.is_valid"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.AbstractFactory.is_valid">[docs]</a>    <span class="k">def</span> <span class="nf">is_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return True if the factory is valid</span>
<span class="sd">        else raise an exception</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">True</span>
</div>
<div class="viewcode-block" id="AbstractFactory.get_id"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.AbstractFactory.get_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the node factory Id &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
</div>
<div class="viewcode-block" id="AbstractFactory.get_documentation"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.AbstractFactory.get_documentation">[docs]</a>    <span class="k">def</span> <span class="nf">get_documentation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;&quot;</span>
</div>
<div class="viewcode-block" id="AbstractFactory.get_python_name"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.AbstractFactory.get_python_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_python_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a valid python variable as name.</span>
<span class="sd">        This is used to store the factory into a python list (i.e. __all__).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

        <span class="k">if</span><span class="p">(</span><span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">isalnum</span><span class="p">()):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;_</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">name</span>
</div>
<div class="viewcode-block" id="AbstractFactory.get_authors"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.AbstractFactory.get_authors">[docs]</a>    <span class="k">def</span> <span class="nf">get_authors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;returns node authors</span>

<span class="sd">        if no authors is found within the node, then it takes the authors field</span>
<span class="sd">        found in its package.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">authors</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">authors</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
            <span class="n">authors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">package</span><span class="o">.</span><span class="n">metainfo</span><span class="p">[</span><span class="s">&#39;authors&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39; (wralea authors)&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">authors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">authors</span>
        <span class="k">return</span> <span class="n">authors</span>
</div>
<div class="viewcode-block" id="AbstractFactory.get_tip"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.AbstractFactory.get_tip">[docs]</a>    <span class="k">def</span> <span class="nf">get_tip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">asRst</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the node description</span>

<span class="sd">        if no authors is found within the node, then it takes the authors field</span>
<span class="sd">        found in its package.</span>
<span class="sd">        &quot;&quot;&quot;</span>


        <span class="k">if</span> <span class="ow">not</span> <span class="n">asRst</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;&lt;b&gt;Name:&lt;/b&gt; </span><span class="si">%s</span><span class="s">&lt;br/&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,)</span> <span class="o">+</span> \
                   <span class="s">&quot;&lt;b&gt;Category:&lt;/b&gt; </span><span class="si">%s</span><span class="s">&lt;br/&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="p">,)</span> <span class="o">+</span> \
                   <span class="s">&quot;&lt;b&gt;Package:&lt;/b&gt; </span><span class="si">%s</span><span class="s">&lt;br/&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">package</span><span class="o">.</span><span class="n">name</span><span class="p">,)</span> <span class="o">+</span> \
                   <span class="s">&quot;&lt;b&gt;Authors:&lt;/b&gt; </span><span class="si">%s</span><span class="s">&lt;br/&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_authors</span><span class="p">(),)</span> <span class="o">+</span> \
                   <span class="s">&quot;&lt;b&gt;Description:&lt;/b&gt; </span><span class="si">%s</span><span class="s">&lt;br/&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">,)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;**Name:** </span><span class="si">%s</span><span class="se">\n\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,)</span> <span class="o">+</span> \
                   <span class="s">&quot;**Category:** </span><span class="si">%s</span><span class="se">\n\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="p">,)</span> <span class="o">+</span> \
                   <span class="s">&quot;**Package:** </span><span class="si">%s</span><span class="se">\n\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">package</span><span class="o">.</span><span class="n">name</span><span class="p">,)</span> <span class="o">+</span> \
                   <span class="s">&quot;**Authors:** </span><span class="si">%s</span><span class="se">\n\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_authors</span><span class="p">(),)</span> <span class="o">+</span> \
                   <span class="s">&quot;**Description:** </span><span class="si">%s</span><span class="se">\n\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">,)</span>
</div>
<div class="viewcode-block" id="AbstractFactory.instantiate"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.AbstractFactory.instantiate">[docs]</a>    <span class="k">def</span> <span class="nf">instantiate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">call_stack</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot; Return a node instance</span>

<span class="sd">        :param call_stack: the list of NodeFactory id already in call stack</span>
<span class="sd">            (in order to avoir infinite recursion)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="AbstractFactory.instantiate_widget"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.AbstractFactory.instantiate_widget">[docs]</a>    <span class="k">def</span> <span class="nf">instantiate_widget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">edit</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
        <span class="n">autonomous</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the corresponding widget initialised with node&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="AbstractFactory.get_writer"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.AbstractFactory.get_writer">[docs]</a>    <span class="k">def</span> <span class="nf">get_writer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the writer class &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="AbstractFactory.copy"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.AbstractFactory.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Copy factory &quot;&quot;&quot;</span>

        <span class="c"># Disable package before copy</span>
        <span class="n">pkg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">package</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">package</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="n">ret</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">packageg</span> <span class="o">=</span> <span class="n">pkg</span>

        <span class="n">old_pkg</span><span class="p">,</span> <span class="n">new_pkg</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s">&#39;replace_pkg&#39;</span><span class="p">]</span>

        <span class="n">ret</span><span class="o">.</span><span class="n">package</span> <span class="o">=</span> <span class="n">new_pkg</span>
        <span class="k">return</span> <span class="n">ret</span>
</div>
<div class="viewcode-block" id="AbstractFactory.clean_files"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.AbstractFactory.clean_files">[docs]</a>    <span class="k">def</span> <span class="nf">clean_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Remove files depending of factory &quot;&quot;&quot;</span>
        <span class="k">pass</span>
</div>
<div class="viewcode-block" id="AbstractFactory.is_data"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.AbstractFactory.is_data">[docs]</a>    <span class="k">def</span> <span class="nf">is_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="AbstractFactory.is_node"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.AbstractFactory.is_node">[docs]</a>    <span class="k">def</span> <span class="nf">is_node</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="AbstractFactory.is_composite_node"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.AbstractFactory.is_composite_node">[docs]</a>    <span class="k">def</span> <span class="nf">is_composite_node</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">False</span>
</div>
    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">odict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="c"># copy the dict since we change it</span>
        <span class="n">odict</span><span class="p">[</span><span class="s">&#39;__pkg__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span> <span class="c"># remove weakref reference</span>
        <span class="k">return</span> <span class="n">odict</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_pkg</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="Alias"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.Alias">[docs]</a><span class="k">def</span> <span class="nf">Alias</span><span class="p">(</span><span class="n">factory</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Create a alias for factory &quot;&quot;&quot;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">factory</span><span class="o">.</span><span class="n">alias</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">factory</span><span class="o">.</span><span class="n">alias</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">factory</span><span class="o">.</span><span class="n">alias</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="NodeFactory"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.NodeFactory">[docs]</a><span class="k">class</span> <span class="nc">NodeFactory</span><span class="p">(</span><span class="n">AbstractFactory</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Node factory is able to create nodes on demand,</span>
<span class="sd">    and their associated widgets.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">name</span><span class="p">,</span>
                 <span class="n">description</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span>
                 <span class="n">category</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span>
                 <span class="n">inputs</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">outputs</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">nodemodule</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span>
                 <span class="n">nodeclass</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">widgetmodule</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">widgetclass</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">search_path</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">authors</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a node factory.</span>

<span class="sd">        :param name: user name for the node (must be unique) (String)</span>
<span class="sd">        :param description: description of the node (String)</span>
<span class="sd">        :param category: category of the node (String)</span>
<span class="sd">        :param inputs: inputs description</span>
<span class="sd">        :param outputs: outputs description</span>
<span class="sd">        :param nodemodule: python module to import for node (String)</span>
<span class="sd">        :param nodeclass:  node class name to be created (String)</span>
<span class="sd">        :param widgetmodule: python module to import for widget (String)</span>
<span class="sd">        :param widgetclass: widget class name (String)</span>
<span class="sd">        :param search_path: list of directories where to search for</span>
<span class="sd">            module</span>

<span class="sd">        :note: inputs and outputs parameters are list of dictionnary such</span>

<span class="sd">        inputs = (dict(name=&#39;x&#39;, interface=IInt, value=0,)</span>
<span class="sd">        outputs = (dict(name=&#39;y&#39;, interface=IInt)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">AbstractFactory</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">category</span><span class="p">,</span>
                                 <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="p">,</span> <span class="n">authors</span><span class="o">=</span><span class="n">authors</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>

        <span class="c"># Factory info</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodemodule_name</span> <span class="o">=</span> <span class="n">nodemodule</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodeclass_name</span> <span class="o">=</span> <span class="n">nodeclass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widgetmodule_name</span> <span class="o">=</span> <span class="n">widgetmodule</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widgetclass_name</span> <span class="o">=</span> <span class="n">widgetclass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">toscriptclass_name</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;toscriptclass_name&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

        <span class="c"># Cache</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodeclass</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">src_cache</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="c"># Module path, value=0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodemodule_path</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span><span class="p">(</span><span class="ow">not</span> <span class="n">search_path</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">search_path</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">search_path</span> <span class="o">=</span> <span class="n">search_path</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">module_cache</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="c"># Context directory</span>
        <span class="c"># inspect.stack()[1][1] is the caller python module</span>
        <span class="n">caller_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">if</span><span class="p">(</span><span class="ow">not</span> <span class="n">caller_dir</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_path</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">search_path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">caller_dir</span><span class="p">)</span>


<div class="viewcode-block" id="NodeFactory.is_node"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.NodeFactory.is_node">[docs]</a>    <span class="k">def</span> <span class="nf">is_node</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">True</span>
</div>
<div class="viewcode-block" id="NodeFactory.get_python_name"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.NodeFactory.get_python_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_python_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return a python valid name &quot;&quot;&quot;</span>

        <span class="n">module_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodemodule_name</span>
        <span class="n">module_name</span> <span class="o">=</span> <span class="n">module_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span><span class="s">&#39;_&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">_</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodemodule_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodeclass_name</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Pickle function &quot;&quot;&quot;</span>
        <span class="n">odict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">odict</span><span class="p">[</span><span class="s">&#39;nodemodule_path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">odict</span><span class="p">[</span><span class="s">&#39;nodemodule&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">odict</span><span class="p">[</span><span class="s">&#39;nodeclass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">odict</span><span class="p">[</span><span class="s">&#39;module_cache&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">odict</span><span class="p">[</span><span class="s">&#39;__pkg__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span> <span class="c"># remove weakref reference</span>

        <span class="k">return</span> <span class="n">odict</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_pkg</span><span class="p">()</span>

<div class="viewcode-block" id="NodeFactory.copy"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.NodeFactory.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Copy factory</span>
<span class="sd">        :param path: new search path</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ret</span> <span class="o">=</span> <span class="n">AbstractFactory</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>
        <span class="n">ret</span><span class="o">.</span><span class="n">search_path</span> <span class="o">=</span> <span class="p">[</span><span class="n">args</span><span class="p">[</span><span class="s">&#39;path&#39;</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">ret</span>
</div>
<div class="viewcode-block" id="NodeFactory.get_classobj"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.NodeFactory.get_classobj">[docs]</a>    <span class="k">def</span> <span class="nf">get_classobj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">module</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_module</span><span class="p">()</span>
        <span class="n">classobj</span> <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodeclass_name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">classobj</span>
</div>
<div class="viewcode-block" id="NodeFactory.get_documentation"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.NodeFactory.get_documentation">[docs]</a>    <span class="k">def</span> <span class="nf">get_documentation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_classobj</span><span class="p">()</span><span class="o">.</span><span class="n">__doc__</span>
</div>
<div class="viewcode-block" id="NodeFactory.instantiate"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.NodeFactory.instantiate">[docs]</a>    <span class="k">def</span> <span class="nf">instantiate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">call_stack</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a node instance.</span>
<span class="sd">        :param call_stack: the list of NodeFactory id already in call stack</span>
<span class="sd">        (in order to avoir infinite recursion)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># The module contains the node implementation.</span>
        <span class="n">module</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_module</span><span class="p">()</span>
        <span class="n">classobj</span> <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodeclass_name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">classobj</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Cannot instantiate &#39;&quot;</span> <span class="o">+</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">nodeclass_name</span> <span class="o">+</span> <span class="s">&quot;&#39; from &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">module</span><span class="p">))</span>

        <span class="c"># If class is not a Node, embed object in a Node class</span>
        <span class="k">if</span><span class="p">(</span><span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">classobj</span><span class="p">,</span> <span class="s">&#39;mro&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">AbstractNode</span> <span class="ow">in</span> <span class="n">classobj</span><span class="o">.</span><span class="n">mro</span><span class="p">()):</span>

            <span class="c"># Check inputs and outputs</span>
            <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
                <span class="n">sign</span> <span class="o">=</span> <span class="n">sgn</span><span class="o">.</span><span class="n">Signature</span><span class="p">(</span><span class="n">classobj</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="o">=</span> <span class="n">sign</span><span class="o">.</span><span class="n">get_parameters</span><span class="p">()</span>
            <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span> <span class="o">=</span> <span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;out&quot;</span><span class="p">,</span> <span class="n">interface</span><span class="o">=</span><span class="bp">None</span><span class="p">),)</span>


            <span class="c"># Check and Instantiate if we have a functor class</span>
            <span class="k">if</span><span class="p">((</span><span class="nb">type</span><span class="p">(</span><span class="n">classobj</span><span class="p">)</span> <span class="o">==</span> <span class="n">types</span><span class="o">.</span><span class="n">TypeType</span><span class="p">)</span>
               <span class="ow">or</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">classobj</span><span class="p">)</span> <span class="o">==</span> <span class="n">types</span><span class="o">.</span><span class="n">ClassType</span><span class="p">)):</span>

                <span class="n">_classobj</span> <span class="o">=</span> <span class="n">classobj</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">_classobj</span><span class="p">):</span>
                    <span class="n">classobj</span> <span class="o">=</span> <span class="n">_classobj</span>

            <span class="n">node</span> <span class="o">=</span> <span class="n">FuncNode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">,</span> <span class="n">classobj</span><span class="p">)</span>

        <span class="c"># Class inherits from Node</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">node</span> <span class="o">=</span> <span class="n">classobj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">node</span> <span class="o">=</span> <span class="n">classobj</span><span class="p">()</span>

        <span class="c"># Properties</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">node</span><span class="o">.</span><span class="n">factory</span> <span class="o">=</span> <span class="bp">self</span>
            <span class="n">node</span><span class="o">.</span><span class="n">lazy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lazy</span>
            <span class="k">if</span><span class="p">(</span><span class="ow">not</span> <span class="n">node</span><span class="o">.</span><span class="n">caption</span><span class="p">):</span>
                <span class="n">node</span><span class="o">.</span><span class="n">set_caption</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

            <span class="n">node</span><span class="o">.</span><span class="n">delay</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delay</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c"># to script</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">toscriptclass_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="p">:</span>
            <span class="n">node</span><span class="o">.</span><span class="n">_to_script_func</span> <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toscriptclass_name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">node</span>
</div>
<div class="viewcode-block" id="NodeFactory.instantiate_widget"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.NodeFactory.instantiate_widget">[docs]</a>    <span class="k">def</span> <span class="nf">instantiate_widget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                            <span class="n">edit</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">autonomous</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the corresponding widget initialised with node &quot;&quot;&quot;</span>

        <span class="c"># Code Editor</span>
        <span class="k">if</span><span class="p">(</span><span class="n">edit</span><span class="p">):</span>
            <span class="kn">from</span> <span class="nn">openalea.visualea.code_editor</span> <span class="kn">import</span> <span class="n">get_editor</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">get_editor</span><span class="p">()(</span><span class="n">parent</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">w</span><span class="o">.</span><span class="n">edit_module</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_node_module</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodeclass_name</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                <span class="c"># Unable to load the module</span>
                <span class="c"># Try to retrieve the file and open the file in an editor</span>
                <span class="n">src_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_file</span><span class="p">()</span>
                <span class="k">print</span> <span class="s">&quot;instantiate widget exception:&quot;</span><span class="p">,</span> <span class="n">e</span>
                <span class="k">if</span> <span class="n">src_path</span><span class="p">:</span>
                    <span class="n">w</span><span class="o">.</span><span class="n">edit_file</span><span class="p">(</span><span class="n">src_path</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">w</span>

        <span class="c"># Node Widget</span>
        <span class="k">if</span><span class="p">(</span><span class="n">node</span> <span class="o">==</span> <span class="bp">None</span><span class="p">):</span>
            <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">instantiate</span><span class="p">()</span>

        <span class="n">modulename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">widgetmodule_name</span>
        <span class="k">if</span><span class="p">(</span><span class="ow">not</span> <span class="n">modulename</span><span class="p">):</span>
            <span class="n">modulename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodemodule_name</span>

        <span class="c"># if no widget declared, we create a default one</span>
        <span class="k">if</span><span class="p">(</span><span class="ow">not</span> <span class="n">modulename</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">widgetclass_name</span><span class="p">):</span>

            <span class="kn">from</span> <span class="nn">openalea.visualea.node_widget</span> <span class="kn">import</span> <span class="n">DefaultNodeWidget</span>
            <span class="k">return</span> <span class="n">DefaultNodeWidget</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">autonomous</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c"># load module</span>
            <span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="n">pathname</span><span class="p">,</span> <span class="n">desc</span><span class="p">)</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="n">find_module</span><span class="p">(</span><span class="n">modulename</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">search_path</span> <span class="o">+</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>

            <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">pathname</span><span class="p">))</span>
            <span class="n">module</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="n">load_module</span><span class="p">(</span><span class="n">modulename</span><span class="p">,</span> <span class="nb">file</span><span class="p">,</span> <span class="n">pathname</span><span class="p">,</span> <span class="n">desc</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

            <span class="k">if</span><span class="p">(</span><span class="nb">file</span><span class="p">):</span>
                <span class="nb">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="n">widgetclass</span> <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">widgetclass_name</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">widgetclass</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="NodeFactory.get_writer"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.NodeFactory.get_writer">[docs]</a>    <span class="k">def</span> <span class="nf">get_writer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the writer class &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">PyNodeFactoryWriter</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="NodeFactory.get_node_module"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.NodeFactory.get_node_module">[docs]</a>    <span class="k">def</span> <span class="nf">get_node_module</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the python module object (if available)</span>
<span class="sd">        Raise an Import Error if no module is associated</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">LOCAL_IMPORT</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodemodule_name</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodemodule_name</span> <span class="o">=</span> <span class="s">&#39;__builtin__&#39;</span>

        <span class="c"># Test if the module is already in sys.modules</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodemodule_path</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module_cache</span> <span class="ow">and</span>
            <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module_cache</span><span class="p">,</span> <span class="s">&#39;oa_invalidate&#39;</span><span class="p">)):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">module_cache</span>

        <span class="n">sav_path</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_path</span> <span class="o">+</span> <span class="n">sav_path</span>
        <span class="c"># print &#39;SEARCH PATH &#39;, self.search_path</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c"># load module</span>

            <span class="c"># Delete the module from the sys.modules if another local exists and</span>
            <span class="c"># has the same name</span>
            <span class="k">if</span> <span class="n">LOCAL_IMPORT</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodemodule_name</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
                    <span class="k">del</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodemodule_name</span><span class="p">]</span>
            <span class="nb">__import__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodemodule_name</span><span class="p">)</span>
            <span class="n">nodemodule</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodemodule_name</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodemodule_path</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getsourcefile</span><span class="p">(</span><span class="n">nodemodule</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="n">type_error</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodemodule_path</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="k">print</span> <span class="n">type_error</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">module_cache</span> <span class="o">=</span> <span class="n">nodemodule</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">sav_path</span>
            <span class="k">return</span> <span class="n">nodemodule</span>

        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">,</span> <span class="n">import_error</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">sav_path</span>
            <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodemodule_name</span>
            <span class="k">raise</span> <span class="n">import_error</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">sav_path</span>
</div>
<div class="viewcode-block" id="NodeFactory.get_node_file"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.NodeFactory.get_node_file">[docs]</a>    <span class="k">def</span> <span class="nf">get_node_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the path of the python module.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodemodule_path</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">module_cache</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodemodule_path</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodemodule_name</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_node_module</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodemodule_path</span>

</div>
<div class="viewcode-block" id="NodeFactory.get_node_src"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.NodeFactory.get_node_src">[docs]</a>    <span class="k">def</span> <span class="nf">get_node_src</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a string containing the node src</span>
<span class="sd">        Return None if src is not available</span>
<span class="sd">        If cache is False, return the source on the disk</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># Return cached source if any</span>
        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">src_cache</span> <span class="ow">and</span> <span class="n">cache</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">src_cache</span>

        <span class="n">module</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_module</span><span class="p">()</span>

        <span class="kn">import</span> <span class="nn">linecache</span>
        <span class="c"># get the code</span>
        <span class="n">linecache</span><span class="o">.</span><span class="n">checkcache</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodemodule_path</span><span class="p">)</span>
        <span class="n">cl</span> <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodeclass_name</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getsource</span><span class="p">(</span><span class="n">cl</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="NodeFactory.apply_new_src"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.NodeFactory.apply_new_src">[docs]</a>    <span class="k">def</span> <span class="nf">apply_new_src</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newsrc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Execute new src and store the source into the factory.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">module</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_module</span><span class="p">()</span>

        <span class="c"># Run src</span>
        <span class="k">exec</span> <span class="n">newsrc</span> <span class="ow">in</span> <span class="n">module</span><span class="o">.</span><span class="n">__dict__</span>

        <span class="c"># save the current newsrc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">src_cache</span> <span class="o">=</span> <span class="n">newsrc</span>
</div>
<div class="viewcode-block" id="NodeFactory.save_new_src"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.NodeFactory.save_new_src">[docs]</a>    <span class="k">def</span> <span class="nf">save_new_src</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newsrc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Execute the new source and replace the text into the old file</span>
<span class="sd">        containing the source.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">module</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_module</span><span class="p">()</span>
        <span class="n">nodesrc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_src</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

        <span class="c"># Run src</span>
        <span class="k">exec</span> <span class="n">newsrc</span> <span class="ow">in</span> <span class="n">module</span><span class="o">.</span><span class="n">__dict__</span>

        <span class="c"># get the module code</span>
        <span class="kn">import</span> <span class="nn">inspect</span>
        <span class="n">modulesrc</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getsource</span><span class="p">(</span><span class="n">module</span><span class="p">)</span>

        <span class="c"># Pass if no modications</span>
        <span class="k">if</span><span class="p">(</span><span class="n">nodesrc</span> <span class="o">==</span> <span class="n">newsrc</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="c"># replace old code with new one</span>
        <span class="n">modulesrc</span> <span class="o">=</span> <span class="n">modulesrc</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">nodesrc</span><span class="p">,</span> <span class="n">newsrc</span><span class="p">)</span>


        <span class="c"># write file</span>
        <span class="n">myfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodemodule_path</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">myfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">modulesrc</span><span class="p">)</span>
        <span class="n">myfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c"># reload module</span>
        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module_cache</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module_cache</span><span class="o">.</span><span class="n">invalidate_oa</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">src_cache</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_module</span><span class="p">()</span>
        <span class="c"># reload(m)</span>
        <span class="c"># Recompile</span>
        <span class="c"># import py_compile</span>
        <span class="c"># py_compile.compile(self.nodemodule_path)</span>

<span class="c"># Class Factory:</span></div></div>
<span class="n">Factory</span> <span class="o">=</span> <span class="n">NodeFactory</span>


<div class="viewcode-block" id="PyNodeFactoryWriter"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.PyNodeFactoryWriter">[docs]</a><span class="k">class</span> <span class="nc">PyNodeFactoryWriter</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; NodeFactory python Writer &quot;&quot;&quot;</span>

    <span class="n">nodefactory_template</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>

<span class="s">$NAME = Factory(name=$PNAME,</span>
<span class="s">                authors=$AUTHORS,</span>
<span class="s">                description=$DESCRIPTION,</span>
<span class="s">                category=$CATEGORY,</span>
<span class="s">                nodemodule=$NODEMODULE,</span>
<span class="s">                nodeclass=$NODECLASS,</span>
<span class="s">                inputs=$LISTIN,</span>
<span class="s">                outputs=$LISTOUT,</span>
<span class="s">                widgetmodule=$WIDGETMODULE,</span>
<span class="s">                widgetclass=$WIDGETCLASS,</span>
<span class="s">               )</span>

<span class="s">&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">factory</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">factory</span> <span class="o">=</span> <span class="n">factory</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the python string representation &quot;&quot;&quot;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span>
        <span class="n">fstr</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">Template</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodefactory_template</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">fstr</span><span class="o">.</span><span class="n">safe_substitute</span><span class="p">(</span><span class="n">NAME</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">get_python_name</span><span class="p">(),</span>
                                      <span class="n">AUTHORS</span><span class="o">=</span><span class="nb">repr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">get_authors</span><span class="p">()),</span>
                                      <span class="n">PNAME</span><span class="o">=</span><span class="nb">repr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
                                      <span class="n">DESCRIPTION</span><span class="o">=</span><span class="nb">repr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">description</span><span class="p">),</span>
                                      <span class="n">CATEGORY</span><span class="o">=</span><span class="nb">repr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">category</span><span class="p">),</span>
                                      <span class="n">NODEMODULE</span><span class="o">=</span><span class="nb">repr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">nodemodule_name</span><span class="p">),</span>
                                      <span class="n">NODECLASS</span><span class="o">=</span><span class="nb">repr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">nodeclass_name</span><span class="p">),</span>
                                      <span class="n">LISTIN</span><span class="o">=</span><span class="nb">repr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">inputs</span><span class="p">),</span>
                                      <span class="n">LISTOUT</span><span class="o">=</span><span class="nb">repr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">outputs</span><span class="p">),</span>
                                      <span class="n">WIDGETMODULE</span><span class="o">=</span><span class="nb">repr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">widgetmodule_name</span><span class="p">),</span>
                                      <span class="n">WIDGETCLASS</span><span class="o">=</span><span class="nb">repr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">widgetclass_name</span><span class="p">),)</span>
        <span class="k">return</span> <span class="n">result</span>

<span class="c"># Utility functions</span></div>
<div class="viewcode-block" id="gen_port_list"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.gen_port_list">[docs]</a><span class="k">def</span> <span class="nf">gen_port_list</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Generate a list of port description &quot;&quot;&quot;</span>
    <span class="n">mylist</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
        <span class="n">mylist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;t&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">interface</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">i</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">mylist</span>

</div>
<div class="viewcode-block" id="initialise_standard_metadata"><a class="viewcode-back" href="../../../openalea/core/doc/user/autosum.html#openalea.core.node.initialise_standard_metadata">[docs]</a><span class="k">def</span> <span class="nf">initialise_standard_metadata</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Declares the standard keys used by the Node structures. Called at the end of this file&quot;&quot;&quot;</span>
    <span class="c"># we declare what are the node model ad hoc data we require:</span>
    <span class="n">AbstractNode</span><span class="o">.</span><span class="n">extend_ad_hoc_slots</span><span class="p">(</span><span class="s">&quot;position&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="s">&quot;posx&quot;</span><span class="p">,</span> <span class="s">&quot;posy&quot;</span><span class="p">)</span>
    <span class="n">Node</span><span class="o">.</span><span class="n">extend_ad_hoc_slots</span><span class="p">(</span><span class="s">&quot;userColor&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&quot;user_color&quot;</span><span class="p">)</span>
    <span class="n">Node</span><span class="o">.</span><span class="n">extend_ad_hoc_slots</span><span class="p">(</span><span class="s">&quot;useUserColor&quot;</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="s">&quot;use_user_color&quot;</span><span class="p">,)</span>
    <span class="n">Annotation</span><span class="o">.</span><span class="n">extend_ad_hoc_slots</span><span class="p">(</span><span class="s">&quot;text&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;txt&quot;</span><span class="p">)</span>
<span class="c">#    Annotation.extend_ad_hoc_slots(&quot;htmlText&quot;, str, None)</span>
    <span class="n">Annotation</span><span class="o">.</span><span class="n">extend_ad_hoc_slots</span><span class="p">(</span><span class="s">&quot;textColor&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="n">Annotation</span><span class="o">.</span><span class="n">extend_ad_hoc_slots</span><span class="p">(</span><span class="s">&quot;rectP2&quot;</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">Annotation</span><span class="o">.</span><span class="n">extend_ad_hoc_slots</span><span class="p">(</span><span class="s">&quot;color&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="n">Annotation</span><span class="o">.</span><span class="n">extend_ad_hoc_slots</span><span class="p">(</span><span class="s">&quot;visualStyle&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="c"># we declare what are the node model ad hoc data we require:</span>
    <span class="n">AbstractPort</span><span class="o">.</span><span class="n">extend_ad_hoc_slots</span><span class="p">(</span><span class="s">&quot;hide&quot;</span> <span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
    <span class="n">AbstractPort</span><span class="o">.</span><span class="n">extend_ad_hoc_slots</span><span class="p">(</span><span class="s">&quot;connectorPosition&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

</div>
<span class="n">initialise_standard_metadata</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">OpenAlea community website</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2014, INRIA VirtualPlants.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3a0.
    </div>
  </body>
</html>